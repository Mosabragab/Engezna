# Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ù†Ø¬Ø²Ù†Ø§ Ø§Ù„Ø°ÙƒÙŠ - AI Smart Assistant

> **Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:** âœ… v2.3 - Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª + Ù†Ø¸Ø§Ù… Embeddings ØªÙ„Ù‚Ø§Ø¦ÙŠ

---

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¯Ø§Ø®Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù†Ø¬Ø²Ù†Ø§ Ù„Ù„ØªÙˆØµÙŠÙ„ØŒ ÙŠØ³ØªØ®Ø¯Ù… **AI Agent Architecture** Ù…Ø¹ OpenAI GPT-4o-mini Ùˆ Function Calling. ÙŠØ¹Ù…Ù„ ÙƒØ¨Ø¯ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ÙŠØ£Ø®Ø° Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ§Ø¬Ø±.

### Ù…Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙØ¹Ù„Ù‡:
- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ØªØ¬Ø§Ø±
- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ÙŠÙˆ ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…
- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±
- ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ­Ø§Ù„ØªÙ‡Ø§
- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ…
- Ø¥Ù†Ø´Ø§Ø¡ ØªØ°Ø§ÙƒØ± Ø¯Ø¹Ù… ÙÙ†ÙŠ
- Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù…ÙˆØ¸Ù Ø¨Ø´Ø±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©

---

## ğŸ—ï¸ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (v2.0)

### Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

| Ø§Ù„Ù…Ù„Ù | Ø§Ù„ÙˆØµÙ |
|-------|-------|
| `src/app/api/chat/route.ts` | API endpoint (Streaming SSE) |
| `src/lib/ai/agentTools.ts` | ØªØ¹Ø±ÙŠÙ 22 Ø£Ø¯Ø§Ø© Ù„Ù„Ù€ Agent |
| `src/lib/ai/agentPrompt.ts` | System Prompt Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ© |
| `src/lib/ai/agentHandler.ts` | Ù…Ø­Ø±Ùƒ Ø§Ù„Ù€ Agent Loop |
| `src/hooks/useAIChat.ts` | React Hook Ù„Ù„ØªÙØ§Ø¹Ù„ |
| `src/lib/store/chat.ts` | Zustand Store Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª |
| `src/components/customer/chat/SmartAssistant.tsx` | UI Component |

### Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…

| Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (v1) | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (v2) |
|-------------------|-------------------|
| Intent Classification + Manual Handlers | AI Agent with Tool Use |
| 4000+ Ø³Ø·Ø± ÙƒÙˆØ¯ | ~500 Ø³Ø·Ø± ÙƒÙˆØ¯ |
| Regex patterns Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ© | Ø§Ù„Ù€ AI ÙŠÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |
| Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ù…Ù†ÙØµÙ„Ø© Ù„ÙƒÙ„ Ù†ÙŠØ© | Ø§Ù„Ù€ AI ÙŠØ®ØªØ§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© |
| ØµØ¹Ø¨ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„ØªÙˆØ³ÙŠØ¹ | Ø³Ù‡Ù„ Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆØ§Øª Ø¬Ø¯ÙŠØ¯Ø© |

---

## ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (22 Tool)

### ğŸ½ï¸ Menu Tools (6)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `get_provider_categories` | Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù†ÙŠÙˆ Ù„ØªØ§Ø¬Ø± Ù…Ø¹ÙŠÙ† |
| `get_menu_items` | Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø© |
| `get_item_details` | ØªÙØ§ØµÙŠÙ„ Ù…Ù†ØªØ¬ + variants + addons |
| `get_item_addons` | Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© |
| `search_menu` | Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ÙŠÙˆ |
| `check_item_availability` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ± |

### ğŸª Provider Tools (4)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `get_provider_info` | Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± |
| `check_provider_open` | Ù‡Ù„ Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†ØŸ |
| `get_delivery_info` | Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ |
| `search_providers` | Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØªØ¬Ø§Ø± |

### ğŸ›’ Order Tools (4)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `get_order_status` | Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ù…Ø¹ÙŠÙ† |
| `get_order_history` | ØªØ§Ø±ÙŠØ® Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ |
| `track_order` | ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ timeline |
| `cancel_order` | Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ (pending ÙÙ‚Ø·) |

### ğŸ‘¤ Customer Tools (2)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `get_customer_addresses` | Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© |
| `get_favorites` | Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ù…ÙØ¶Ù„ÙŠÙ† |

### ğŸ Promotions Tools (2)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `get_provider_promotions` | **Ù…Ø­Ø³Ù‘Ù†** - ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠØ© + Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ÙØ¶Ø© (original_price > price) Ù…Ø¹ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… |
| `validate_promo_code` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø®ØµÙ… |

### â­ Reviews Tools (1)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `get_provider_reviews` | ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø± |

### ğŸ« Support Tools (2)

| Tool | Ø§Ù„ÙˆØµÙ |
|------|-------|
| `create_support_ticket` | Ø¥Ù†Ø´Ø§Ø¡ ØªØ°ÙƒØ±Ø© Ø¯Ø¹Ù… |
| `escalate_to_human` | ØªØ­ÙˆÙŠÙ„ Ù„Ù…ÙˆØ¸Ù Ø¨Ø´Ø±ÙŠ |

---

## ğŸ”„ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Agent LoopØŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      User Message                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GPT-4o-mini                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ System Prompt + Context + Available Tools                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                         â†“
      [Tool Call?]               [Final Response]
              â†“                         â†“
    Execute Tool(s)              Stream to Client
              â†“
    Add Result to Context
              â†“
    Loop Back to GPT
```

### Ù…Ø«Ø§Ù„ ØªÙØ§Ø¹Ù„ÙŠ

```
ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "Ø¹Ø§ÙŠØ² Ø¨ÙŠØªØ²Ø§"

ğŸ¤– GPT ÙŠØ­Ù„Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©...
   â†’ ÙŠÙ‚Ø±Ø± Ø§Ø³ØªØ¯Ø¹Ø§Ø¡: search_menu(query: "Ø¨ÙŠØªØ²Ø§")

ğŸ”§ Tool Result:
   [
     { name: "Ø¨ÙŠØªØ²Ø§ Ù…Ø§Ø±Ø¬Ø±ÙŠØªØ§", price: 80, provider: "Ø³Ù„Ø·Ø§Ù†" },
     { name: "Ø¨ÙŠØªØ²Ø§ Ø¨ÙŠØ¨Ø±ÙˆÙ†ÙŠ", price: 95, provider: "Ø³Ù„Ø·Ø§Ù†" }
   ]

ğŸ¤– GPT ÙŠÙˆÙ„Ø¯ Ø§Ù„Ø±Ø¯:
   "Ù„Ù‚ÙŠØª ÙƒØ°Ø§ Ù†ÙˆØ¹ Ø¨ÙŠØªØ²Ø§ ğŸ•
    - Ø¨ÙŠØªØ²Ø§ Ù…Ø§Ø±Ø¬Ø±ÙŠØªØ§ (80 Ø¬.Ù…) Ù…Ù† Ø³Ù„Ø·Ø§Ù†
    - Ø¨ÙŠØªØ²Ø§ Ø¨ÙŠØ¨Ø±ÙˆÙ†ÙŠ (95 Ø¬.Ù…) Ù…Ù† Ø³Ù„Ø·Ø§Ù†

    ØªØ­Ø¨ Ø£Ø¶ÙŠÙÙ„Ùƒ Ø£ÙŠÙ‡Ù… Ù„Ù„Ø³Ù„Ø©ØŸ"
```

---

## ğŸ“¡ API Reference

### POST /api/chat (Streaming)

#### Request Body

```typescript
interface ChatRequest {
  messages: Array<{ role: 'user' | 'assistant'; content: string }>
  customer_id?: string
  city_id?: string
  governorate_id?: string
  customer_name?: string
  selected_provider_id?: string
  selected_provider_name?: string
  cart_provider_id?: string
  cart_items?: Array<{
    id: string
    name: string
    quantity: number
    price: number
  }>
  cart_total?: number
}
```

#### Response (Server-Sent Events)

```typescript
// Content streaming
event: content
data: { "chunk": "Ù„Ù‚ÙŠØª ÙƒØ°Ø§ Ù†ÙˆØ¹..." }

// Tool call notification
event: tool_call
data: { "tool": "search_menu", "args": { "query": "Ø¨ÙŠØªØ²Ø§" } }

// Final message
event: message
data: {
  "content": "...",
  "suggestions": ["ğŸ›’ Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©", "ğŸ” Ø¨Ø­Ø« ØªØ§Ù†ÙŠ"],
  "quick_replies": [...],
  "products": [...]
}

// Done
event: done
data: {}
```

### PUT /api/chat (Non-Streaming)

Ù†ÙØ³ Ø§Ù„Ù€ Request Body Ù„ÙƒÙ† ÙŠØ±Ø¬Ø¹ JSON Ù…Ø¨Ø§Ø´Ø±Ø©:

```json
{
  "content": "...",
  "suggestions": [...],
  "quick_replies": [...],
  "products": [...]
}
```

---

## ğŸ¨ System Prompt

Ø§Ù„Ù€ Agent ÙŠØªØ¨Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:

1. **Ø§Ù„Ø±Ø¯ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ** - ÙƒÙ„Ù…Ø§Øª Ø²ÙŠ "Ø¹Ø§ÙŠØ²"ØŒ "ØªÙ…Ø§Ù…"ØŒ "Ø¯Ù‡"
2. **Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø¯Ø§Ø¦Ù…Ø§Ù‹** - Ù…Ø§ÙŠØ±Ø¯Ø´ Ù…Ù† Ø¯Ù…Ø§ØºÙ‡
3. **Ø±Ø¯ÙˆØ¯ Ù‚ØµÙŠØ±Ø© ÙˆÙ…ÙÙŠØ¯Ø©** - Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ø§ÙŠØ² Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø³Ø±Ø¹Ø©
4. **Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨** - Ø§Ù‚ØªØ±Ø§Ø­ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
5. **ÙÙ‡Ù… Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ©** - "Ø¨ÙŠØªØ°Ø§" = "Ø¨ÙŠØªØ²Ø§"
6. **Ø§Ø­ØªØ±Ø§Ù… Ø³ÙŠØ§Ù‚ Ø§Ù„Ø³Ù„Ø©** - Ù„Ùˆ ÙÙŠÙ‡Ø§ Ø£ØµÙ†Ø§Ù Ù…Ù† ØªØ§Ø¬Ø±ØŒ ÙŠØ±ÙƒØ² Ø¹Ù„ÙŠÙ‡
7. **Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¯Ø¹Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©** - Ù…Ø´Ø§ÙƒÙ„ Ù…Ø¹Ù‚Ø¯Ø© â†’ Ù…ÙˆØ¸Ù Ø¨Ø´Ø±ÙŠ

---

## ğŸ” Ø§Ù„Ø£Ù…Ø§Ù†

- **Ø£Ø¯ÙˆØ§Øª ØªØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„:**
  - `get_customer_addresses`
  - `get_favorites`
  - `get_order_history`
  - `cancel_order`
  - `create_support_ticket`

- **Lazy OpenAI Client** - Ù„Ø§ ÙŠØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù€ client Ø¥Ù„Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
- **Max Iterations** - Ø§Ù„Ù€ Agent loop Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù€ 5 iterations
- **Error Handling** - ÙƒÙ„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙŠØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§

---

## ğŸ“Š Logging

```bash
# Tool calls
[Tool Result] search_menu: { success: true, data: [...] }

# Errors
[Agent Error]: OpenAI API error...
[Chat API Error]: ...
```

---

## ğŸš€ Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©

### 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø¯Ø§Ø© ÙÙŠ `agentTools.ts`

```typescript
// ÙÙŠ AGENT_TOOLS array
{
  name: 'my_new_tool',
  description: 'ÙˆØµÙ Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ',
  parameters: {
    type: 'object',
    properties: {
      param1: {
        type: 'string',
        description: 'ÙˆØµÙ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„'
      }
    },
    required: ['param1']
  }
}
```

### 2. ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ø¯Ø§Ø© ÙÙŠ `executeAgentTool`

```typescript
case 'my_new_tool': {
  const { param1 } = params as { param1: string }

  const { data, error } = await supabase
    .from('table')
    .select('...')
    .eq('field', param1)

  if (error) throw error
  return { success: true, data }
}
```

---

## ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© (v1 â†’ v2)

ØªÙ… Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø£Ù†Ù‡Ø§ Ø£ØµØ¨Ø­Øª ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©:

- `src/lib/ai/tools.ts` - Ø£Ø¯ÙˆØ§Øª Ù‚Ø¯ÙŠÙ…Ø©
- `src/lib/ai/systemPrompt.ts` - prompt Ù‚Ø¯ÙŠÙ…
- `src/lib/ai/responsePersonality.ts` - Ù‚ÙˆØ§Ù„Ø¨ Ø±Ø¯ÙˆØ¯
- `src/lib/ai/intentClassifier.ts` - ØªØµÙ†ÙŠÙ Ø§Ù„Ù†ÙˆØ§ÙŠØ§
- `src/lib/ai/intentHandlers.ts` - Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ù†ÙˆØ§ÙŠØ§
- `src/lib/ai/normalizeArabic.ts` - ØªØ·Ø¨ÙŠØ¹ Ø¹Ø±Ø¨ÙŠ
- `src/lib/ai/prompts.ts` - prompts Ø¥Ø¶Ø§ÙÙŠØ©
- `src/lib/ai/menu-analyzer.ts` - Ù…Ø­Ù„Ù„ Ø§Ù„Ù…Ù†ÙŠÙˆ
- `src/lib/ai/comparison-engine.ts` - Ù…Ø­Ø±Ùƒ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
- `src/lib/ai/context-builder.ts` - Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ù‚
- `src/lib/ai/index.ts` - re-exports

---

## âœ… Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ v2.0

- **AI Agent Architecture** - Ø§Ù„Ù€ AI ÙŠØ®ØªØ§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø¨Ù†ÙØ³Ù‡
- **Streaming Responses** - Ø§Ù„Ø±Ø¯ÙˆØ¯ ØªØ¸Ù‡Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
- **22 Ø£Ø¯Ø§Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©** - ØªØºØ·ÙŠ ÙƒÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
- **Context-Aware** - ÙŠÙÙ‡Ù… Ø³ÙŠØ§Ù‚ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„ØªØ§Ø¬Ø±
- **Provider-Specific Welcome** - Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ ØªØ§Ø¬Ø±
- **Error Recovery** - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø°ÙƒÙŠØ©
- **Cleaner Codebase** - ÙƒÙˆØ¯ Ø£Ù†Ø¸Ù ÙˆØ£Ø³Ù‡Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©

---

## ğŸ§  Ù†Ø¸Ø§Ù… Embeddings Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø¬Ø¯ÙŠØ¯ v2.3)

### Ø§Ù„Ù‡Ø¯Ù

ØªÙˆÙ„ÙŠØ¯ embeddings ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ù†ÙŠÙˆ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ (Semantic Search).

### Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª

| Ø§Ù„Ù…ÙƒÙˆÙ† | Ø§Ù„Ù…Ù„Ù | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-------|---------|
| Edge Function | `supabase/functions/generate-embedding/` | ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù€ embedding Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… OpenAI |
| Migration | `20251215000002_embedding_auto_generation.sql` | Triggers + Queue + pg_cron |
| API Route | `src/app/api/embeddings/route.ts` | Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª + ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ |
| Webhook | `src/app/api/webhooks/menu-item/route.ts` | Ù…Ø¹Ø§Ù„Ø¬Ø© INSERT/UPDATE |

### ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ØŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Menu Item INSERT/UPDATE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Database Trigger â†’ embedding_queue                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        pg_cron (ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚) Ø£Ùˆ Webhook                        â”‚
â”‚              â†“                                                â”‚
â”‚     Edge Function: generate-embedding                         â”‚
â”‚              â†“                                                â”‚
â”‚     OpenAI text-embedding-3-small (1536 dims)                â”‚
â”‚              â†“                                                â”‚
â”‚     Store in menu_items.embedding                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Embedding Text Format

ÙŠØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Øµ Ù„Ù„Ù€ embedding Ù…Ù†:
- Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹Ø±Ø¨ÙŠ + Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)
- Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ + Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)
- Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…
- Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø±
- Ø§Ù„Ø³Ø¹Ø±

```
"Ø¨ÙŠØªØ²Ø§ Ù…Ø§Ø±Ø¬Ø±ÙŠØªØ§ | Pizza Margherita | Ø¹Ø¬ÙŠÙ†Ø© Ø·Ø§Ø²Ø¬Ø© Ù…Ø¹ ØµÙˆØµ Ø·Ù…Ø§Ø·Ù… | Ù‚Ø³Ù…: Ø¨ÙŠØªØ²Ø§ | Ù…Ù†: Ø³Ù„Ø·Ø§Ù† Ø¨ÙŠØªØ²Ø§ | Ø§Ù„Ø³Ø¹Ø±: 85 Ø¬Ù†ÙŠÙ‡"
```

### Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºØ·ÙŠØ©

```sql
-- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
SELECT * FROM get_embedding_stats();

-- Ø§Ù„Ù†ØªÙŠØ¬Ø©
-- total_items: 150
-- items_with_embedding: 145
-- items_without_embedding: 5
-- coverage_percentage: 96.67
-- pending_in_queue: 3
-- failed_in_queue: 0
```

### Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Embedding Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ÙŠÙ†

```sql
SELECT queue_missing_embeddings(100); -- ÙŠØ¶ÙŠÙ 100 Ù…Ù†ØªØ¬ Ù„Ù„Ù€ queue
```

---

## ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª

### v2.3 (16 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025)
- âœ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… ÙˆØµÙˆÙ„ Provider ID Ù„Ù„Ù€ Agent
- âœ… ØªØ­Ø³ÙŠÙ† `get_provider_promotions` Ù„ÙŠØ±Ø¬Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ÙØ¶Ø©
- âœ… Ø¥Ø¶Ø§ÙØ© Ø¬Ù„Ø¨ Ø§Ù„Ù€ variants inline ÙÙŠ `search_menu`
- âœ… Ù†Ø¸Ø§Ù… Embeddings ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯
- âœ… Ù‚ÙˆØ§Ø¹Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© ÙÙŠ System Prompt

### v2.2 (15 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025)
- Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ ÙƒØ§Ù…Ù„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AI Agent Architecture

### v2.1 (13 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025)
- Ø¥ØµÙ„Ø§Ø­ Ø²Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
- ØªØ­Ø³ÙŠÙ† Arabic Normalization

---

*Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 16 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025*
