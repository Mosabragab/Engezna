# ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© â€” Ø¥Ù†Ø¬Ø²Ù†Ø§ (Engezna)

**Ø§Ù„ØªØ§Ø±ÙŠØ®:** 26 ÙØ¨Ø±Ø§ÙŠØ± 2026
**Ø§Ù„Ù…Ø¯Ù‚Ù‚:** Claude (Senior Software Architect)
**Ø§Ù„Ù†Ø³Ø®Ø©:** 3.1 â€” Deep-Dive Engineering Design Review + Implementation Tracking
**Ø§Ù„Ù†Ø·Ø§Ù‚:** Production Readiness Ù„Ù€ 10,000 Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ²Ø§Ù…Ù†
**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø­Ø§Ù„Ø©:** 26 ÙØ¨Ø±Ø§ÙŠØ± 2026 (Session 2 â€” Performance & API Fixes)

---

## Ù…Ù„Ø®Øµ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°

```
Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  56% Ù…ÙƒØªÙ…Ù„ (14/25 Ø¨Ù†Ø¯)

Ø§Ù„Ù…Ø±Ø­Ù„Ø© 0 (Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙÙˆØ±ÙŠ):       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  4.5/5  (90%)
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 (Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª):       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  5/5    (100%) âœ…
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 (Frontend):             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2.5/4  (63%)
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3 (Ø§Ù„Ù…ØªØ§Ù†Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©):     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2.5/6  (42%)
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4 (Ø§Ù„ØªØ­Ø¬ÙŠÙ…):               â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  1.5/5  (30%)
```

| Ø§Ù„Ø­Ø§Ù„Ø©     | Ø§Ù„Ø¹Ø¯Ø¯ | Ø§Ù„Ø¨Ù†ÙˆØ¯                                        |
| ---------- | ----- | --------------------------------------------- |
| âœ… Ù…ÙƒØªÙ…Ù„   | 11    | #2, #3, #4, #5, #6, #7, #8, #9, #10, #19, #23 |
| ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | 8     | #1, #12, #13, #14, #15, #16, #18, #21         |
| âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | 6     | #11, #17, #20, #22, #24, #25                  |

---

## Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ

| Ø§Ù„Ù…Ù‚ÙŠØ§Ø³                    | Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°)        | Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°)   |
| -------------------------- | ----------------------------------- | ------------------------------ |
| **Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…**          | **61/100**                          | **~82/100**                    |
| **Ù…Ø´Ø§ÙƒÙ„ Ø­Ø±Ø¬Ø© (CRITICAL)**  | 8                                   | 2 (ØªÙ… Ø­Ù„ 6)                    |
| **Ù…Ø´Ø§ÙƒÙ„ Ø¹Ø§Ù„ÙŠØ© (HIGH)**     | 11                                  | 5 (ØªÙ… Ø­Ù„ 6)                    |
| **Ù…Ø´Ø§ÙƒÙ„ Ù…ØªÙˆØ³Ø·Ø© (MEDIUM)**  | 14                                  | 8 (ØªÙ… Ø­Ù„ 6)                    |
| **Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù€ 10K Ù…ØªØ²Ø§Ù…Ù†** | **ØºÙŠØ± Ø¬Ø§Ù‡Ø² â€” Ø³ÙŠØ³Ù‚Ø· Ø®Ù„Ø§Ù„ 2-4 Ø³Ø§Ø¹Ø§Øª** | **Ø¬Ø²Ø¦ÙŠ â€” ÙŠØªØ­Ù…Ù„ ~8,000 Ù…Ø¹ Ø¨Ø·Ø¡** |

### Ø§Ù„ØªØµÙ†ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­ÙˆØ±

| Ø§Ù„Ù…Ø­ÙˆØ±                           | Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© | Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© | Ø§Ù„Ø­Ø§Ù„Ø©                                                  |
| -------------------------------- | -------------- | -------------- | ------------------------------------------------------- |
| Infrastructure Efficiency & Cost | 45/100         | **74/100**     | âœ… ØªØ­Ø³Ù† ÙƒØ¨ÙŠØ± â€” Cache Ù…ÙˆØ³Ù‘Ø¹ + Polling + Realtime         |
| Data Integrity & Concurrency     | 50/100         | **88/100**     | âœ… ØªØ­Ø³Ù† Ø¬Ø°Ø±ÙŠ â€” Atomic RPC + Guards + RLS                |
| Resiliency & Error Handling      | 62/100         | **72/100**     | ğŸ”¶ ØªØ­Ø³Ù† â€” withErrorHandler Ù…ÙÙØ¹Ù‘Ù„ Ø¬Ø²Ø¦ÙŠØ§Ù‹ (4 routes)     |
| Security & Observability         | 72/100         | **79/100**     | ğŸ”¶ ØªØ­Ø³Ù† â€” withValidation Ù…ÙÙØ¹Ù‘Ù„ Ø¬Ø²Ø¦ÙŠØ§Ù‹ + Zod schemas    |
| Frontend Architecture            | 40/100         | **58/100**     | ğŸ”¶ ØªØ­Ø³Ù† Ù…Ù„Ø­ÙˆØ¸ â€” 13 loading.tsx + dynamic imports Ù…Ø­Ø³Ù‘Ù†Ø© |

---

## Ø§Ù„Ù‚Ø³Ù… 1: Infrastructure Efficiency & Cost (45/100)

### 1.1 ÙƒØ§Ø±Ø«Ø© Realtime: Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  WAL Query #1:  12,537,981 Ø§Ø³ØªØ¯Ø¹Ø§Ø¡  =  75,106 Ø«Ø§Ù†ÙŠØ©        â•‘
â•‘                 = 20.9 Ø³Ø§Ø¹Ø© ÙˆÙ‚Øª CPU Ø®Ø§Ù„Øµ                   â•‘
â•‘  WAL Query #2:   2,141,851 Ø§Ø³ØªØ¯Ø¹Ø§Ø¡  =  11,121 Ø«Ø§Ù†ÙŠØ©        â•‘
â•‘                 =  3.1 Ø³Ø§Ø¹Ø© ÙˆÙ‚Øª CPU Ø®Ø§Ù„Øµ                   â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘
â•‘  Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 14.68 Ù…Ù„ÙŠÙˆÙ† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ = 24 Ø³Ø§Ø¹Ø© CPU                â•‘
â•‘  Ù‡Ø°Ø§ ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ù„Ù€ Realtime ÙÙ‚Ø·!              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Ø§Ù„ØªØ´Ø®ÙŠØµ:** Ø±ØºÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù…Ù† 10 Ø¥Ù„Ù‰ 1ØŒ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø§Ø±ØªÙØ¹Øª Ù…Ù† 10.5M Ø¥Ù„Ù‰ 12.5M (Ø²ÙŠØ§Ø¯Ø© 19%). Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù„ÙŠØ³Øª ÙÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¨Ù„ ÙÙŠ **Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª** â€” ÙƒÙ„ WAL change ÙŠÙ…Ø± Ø¹Ø¨Ø± filter evaluation Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠØ·Ø§Ø¨Ù‚ Ø£ÙŠ subscription.

**Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯:** Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Realtime ÙˆØ§Ù„ØªÙŠ Ù„Ø§ ØªØ­ØªØ§Ø¬. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø¶Ø§ÙØ© Ù„Ù€ `supabase_realtime` publicationØŒ Ù…Ù…Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† ÙƒÙ„ INSERT/UPDATE/DELETE Ø¹Ù„Ù‰ Ø£ÙŠ Ø¬Ø¯ÙˆÙ„ ÙŠÙ…Ø± Ø¹Ø¨Ø± WAL processing.

### 1.2 Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù€ governorates: 576,006 Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù„Ù€ 27 ØµÙ

```sql
-- Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙŠÙØ³ØªØ¯Ø¹Ù‰ 576,006 Ù…Ø±Ø©:
SELECT id, name_ar, name_en, is_active FROM governorates
-- Ø¨Ù…Ø¹Ø¯Ù„ 0.06ms Ù„ÙƒÙ„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ = 34.2 Ø«Ø§Ù†ÙŠØ© Ø¥Ø¬Ù…Ø§Ù„ÙŠ
-- Ù„ÙƒÙ† 27 ØµÙ Ù„Ø§ ØªØªØºÙŠØ± Ø£Ø¨Ø¯Ø§Ù‹!
```

**Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** `Footer.tsx` + middleware + ØµÙØ­Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© ØªØ³ØªØ¹Ù„Ù… Ø¹Ù† Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙÙŠ ÙƒÙ„ Ø·Ù„Ø¨. Ù‡Ø°Ù‡ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø¨Ù‡ Ø«Ø§Ø¨ØªØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ÙØ®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ø¨Ù€ TTL Ø·ÙˆÙŠÙ„ (24 Ø³Ø§Ø¹Ø©).

**Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø§Ù„ÙŠ:** Ø¹Ù„Ù‰ Supabase Free/Pro tierØŒ Ù‡Ø°Ø§ ÙŠØ³ØªÙ‡Ù„Ùƒ Ø­ØµØ© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù‚ÙŠÙ…Ø© Ù…Ø¶Ø§ÙØ©.

### 1.3 Polling Ø¨Ø¯ÙˆÙ† Ø°ÙƒØ§Ø¡: ØªÙƒÙ„ÙØ© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ

| Ø§Ù„Ù…ÙƒÙˆÙ†           | Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª/Ø¯ÙˆØ±Ø© | Ø§Ù„ÙØªØ±Ø©     | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ÙŠÙ† | Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª/Ø«Ø§Ù†ÙŠØ© |
| ---------------- | ---------------- | ---------- | -------------------- | ----------------- |
| ProviderLayout   | 6 Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª      | 60 Ø«Ø§Ù†ÙŠØ©   | 200 ØªØ§Ø¬Ø±             | 20/Ø«              |
| BottomNavigation | 2 Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª      | 30 Ø«Ø§Ù†ÙŠØ©   | 5,000 Ø¹Ù…ÙŠÙ„           | 333/Ø«             |
| Admin Layout     | 5 Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª      | 30 Ø«Ø§Ù†ÙŠØ©   | 10 Ù…Ø¯ÙŠØ±              | 1.7/Ø«             |
| getUser() Ù…ÙƒØ±Ø±   | 1 Ø§Ø³ØªØ¹Ù„Ø§Ù…        | ÙƒÙ„ poll    | 5,200                | 173/Ø«             |
| Middleware       | 1-3 Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª    | ÙƒÙ„ request | ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª           | ~500/Ø«            |
| **Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹**      |                  |            |                      | **~1,028/Ø«**      |

**Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©:**

1. **Ù„Ø§ ÙŠÙˆØ¬Ø¯ `document.visibilitychange` guard:** Ø§Ù„Ù€ polling ÙŠØ³ØªÙ…Ø± Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ÙŠÙØªØ­ Ø§Ù„ØªØ§Ø¨ ÙˆÙŠÙ†Ø³Ø§Ù‡ ÙŠÙÙƒÙ„Ù 4,320 Ø§Ø³ØªØ¹Ù„Ø§Ù…/Ø³Ø§Ø¹Ø©
2. **`getUser()` ÙŠÙØ³ØªØ¯Ø¹Ù‰ Ù…Ø¹ ÙƒÙ„ poll:** ÙÙŠ `BottomNavigation.tsx`ØŒ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ `supabase.auth.getUser()` â€” ÙˆÙ‡Ø°Ø§ ÙŠÙØ±Ø³Ù„ Ø·Ù„Ø¨ HTTP Ù„Ù€ Supabase Auth service. Ø¹Ù†Ø¯ 5,000 Ø¹Ù…ÙŠÙ„ = 167 Ø·Ù„Ø¨ auth Ø¥Ø¶Ø§ÙÙŠ/Ø«Ø§Ù†ÙŠØ©
3. **Pending Orders ØªØ¬Ù„Ø¨ Ø§Ù„ØµÙÙˆÙ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† COUNT:** `ProviderLayout` ÙŠØ¬Ù„Ø¨ `select('id, status')` Ø«Ù… ÙŠØ¹Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¯Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… `count: 'exact', head: true`
4. **Ù„Ø§ ÙŠÙˆØ¬Ø¯ parallelization ÙÙŠ Admin:** 5 Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª ØªÙÙ†ÙØ° Ø¨Ø§Ù„ØªØªØ§Ø¨Ø¹ Ø¨Ø¯Ù„ `Promise.all`

### 1.4 Ø£Ù†Ø¸Ù…Ø© Ù…Ø¨Ù†ÙŠØ© â€” Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„

| Ø§Ù„Ù†Ø¸Ø§Ù…                      | Ø§Ù„Ù…Ù„Ù                                  | Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©              | Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©                                                                                                          |
| --------------------------- | -------------------------------------- | --------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| **Cache Layer (LRU + TTL)** | `src/lib/cache/cached-queries.ts`      | ØµÙØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Production   | ğŸ”¶ **Ø¬Ø²Ø¦ÙŠ** â€” Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ `Footer.tsx` + `CategoriesSection.tsx`. Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† (admin pages) Ù„Ø§ ØªØ²Ø§Ù„ ØªØ³ØªØ¹Ù„Ù… Ù…Ø¨Ø§Ø´Ø±Ø©        |
| **Realtime Manager**        | `src/lib/supabase/realtime-manager.ts` | ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…                  | âœ… **Ù…ÙÙØ¹Ù‘Ù„** â€” ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ `ProviderLayout.tsx` Ù…Ø¹ `subscribeWithErrorHandling()`                                       |
| **`withErrorHandler`**      | `src/lib/api/error-handler.ts`         | Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ 0 Ù…Ù† 45 API route | ğŸ”¶ **Ø¬Ø²Ø¦ÙŠ** â€” Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ 5 routes: `banners/track`, `contact`, `admin/stats`, `admin/orders`, `auth/resend-verification` |
| **`withValidation`**        | `src/lib/api/validate.ts`              | Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ 2 Ù…Ù† 45 route     | ğŸ”¶ **Ø¬Ø²Ø¦ÙŠ** â€” Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ 2 routes: `banners/track` (Zod schema), `contact` (Zod schema)                                  |
| **`strongPasswordSchema`**  | `src/lib/validations/common.ts`        | Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ auth          | âŒ **Ù„Ø§ ÙŠØ²Ø§Ù„ ØºÙŠØ± Ù…ÙÙØ¹Ù‘Ù„** â€” Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© auth                                                                  |
| **Visibility Polling**      | `src/hooks/useVisibilityPolling.ts`    | _(Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹)_          | âœ… **Ù…ÙÙ†Ø¬Ø²** â€” ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ `BottomNavigation.tsx` Ùˆ `ProviderLayout.tsx`                                                 |

> **ØªØ­Ø¯ÙŠØ«:** ØªÙ… ØªÙØ¹ÙŠÙ„ 2 Ù…Ù† 5 Ø£Ù†Ø¸Ù…Ø© (Cache Ø¬Ø²Ø¦ÙŠØ§Ù‹ØŒ Realtime Manager Ø¨Ø§Ù„ÙƒØ§Ù…Ù„). Ù„ÙƒÙ† 3 Ø£Ù†Ø¸Ù…Ø© Ø­Ø±Ø¬Ø© (`withErrorHandler`ØŒ `withValidation`ØŒ `strongPasswordSchema`) Ù„Ø§ ØªØ²Ø§Ù„ ØºÙŠØ± Ù…ÙÙØ¹Ù‘Ù„Ø© ÙˆØªÙÙ…Ø«Ù‘Ù„ Ø£Ø¹Ù„Ù‰ ROI Ù…ØªØ¨Ù‚ÙŠ â€” Ø§Ù„ÙƒÙˆØ¯ Ø¬Ø§Ù‡Ø² ÙˆÙŠØ­ØªØ§Ø¬ ÙÙ‚Ø· Ø±Ø¨Ø·Ù‡ Ø¨Ø§Ù„Ù€ API routes.

### 1.5 Indexes: 120+ ÙÙ‡Ø±Ø³ Ù…ÙŠØª

Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª `pg_stat_user_indexes` Ù…Ø¹ `idx_scan = 0`:

- **120+ ÙÙ‡Ø±Ø³ Ù„Ù… ÙŠÙØ³ØªØ®Ø¯Ù… Ø£Ø¨Ø¯Ø§Ù‹** Ù…Ù†Ø° Ø¢Ø®Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù„Ù€ PostgreSQL
- **`idx_menu_items_embedding`:** 3,296 KB â€” ÙÙ‡Ø±Ø³ embedding Ø«Ù‚ÙŠÙ„ Ù„Ù… ÙŠÙØ³ØªØ¯Ø¹Ù‰ ÙˆÙ„Ùˆ Ù…Ø±Ø©
- **`provider_staff` indexes:** Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ 0 ØµÙÙˆÙ Ù„ÙƒÙ† Ø¹Ù†Ø¯Ù‡ ÙÙ‡Ø§Ø±Ø³ Ù…ÙØ¹Ù„Ø© ØªØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø©
- ÙƒÙ„ `INSERT`/`UPDATE` Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙŠÙØ­Ø¯Ù‘Ø« ÙƒÙ„ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…ÙŠØªØ©

**Ø§Ù„Ø£Ø«Ø± Ø¹Ù„Ù‰ Write Performance:** ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© ÙƒØªØ§Ø¨Ø© ÙÙŠ `orders` Ù…Ø«Ù„Ø§Ù‹ ØªÙØ­Ø¯Ù‘Ø« Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…ÙŠØªØ© Ù…Ø¹ Ø§Ù„ÙØ¹Ø§Ù„Ø©. Ù‡Ø°Ø§ overhead ÙŠØªØ±Ø§ÙƒÙ… Ø®Ø§ØµØ© ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„ÙƒØªØ§Ø¨Ø©.

---

## Ø§Ù„Ù‚Ø³Ù… 2: Data Integrity & Concurrency (50/100)

### 2.1 CRITICAL: Checkout ØºÙŠØ± Ø°Ø±ÙŠ â€” Ø£Ø®Ø·Ø± Ø«ØºØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Ù…Ø³Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ (COD):                                   â•‘
â•‘                                                              â•‘
â•‘  Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ø¯ÙŠØ« usage_count Ù„Ù„Ù€ promo â”€â”€â”€â”€â”€â”€â”€â”€ âœ… Ù†Ø¬Ø­     â•‘
â•‘  Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ promo_code_usage â”€â”€â”€â”€â”€â”€â”€â”€ âœ… Ù†Ø¬Ø­     â•‘
â•‘  Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ âœ… Ù†Ø¬Ø­     â•‘
â•‘  Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ order_items â”€â”€â”€ âŒ ÙØ´Ù„    â•‘
â•‘                                                              â•‘
â•‘  Ø§Ù„Ù†ØªÙŠØ¬Ø©: Ø·Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø¹Ù†Ø§ØµØ±!                          â•‘
â•‘  Ø§Ù„Ù€ catch block ÙŠØ³ØªØ±Ø¬Ø¹ Ø§Ù„Ù€ promo ÙÙ‚Ø· â€” Ù„Ø§ ÙŠØ­Ø°Ù Ø§Ù„Ø·Ù„Ø¨       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Ø§Ù„Ù…Ù„Ù:** `src/app/[locale]/checkout/page.tsx` (Ø£Ø³Ø·Ø± 1056-1276)

Ù‡Ø°Ù‡ Ø£Ø±Ø¨Ø¹ Ø¹Ù…Ù„ÙŠØ§Øª DB Ù…Ù†ÙØµÙ„Ø© **Ø¨Ø¯ÙˆÙ† Ø£ÙŠ transaction wrapper**. Ù„Ø§ ÙŠÙˆØ¬Ø¯ `BEGIN`/`COMMIT`/`ROLLBACK` ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.

**Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ÙØ´Ù„ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ:**

- Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ·Ù„Ø¨ 15 ØµÙ†Ù Ù…Ø¹ promo code
- Ø§Ù„Ø®Ø·ÙˆØ§Øª 1-3 ØªÙ†Ø¬Ø­
- Ø§Ù„Ø®Ø·ÙˆØ© 4 ØªÙØ´Ù„ (timeoutØŒ RLS errorØŒ constraint violation)
- Ø§Ù„ØªØ§Ø¬Ø± ÙŠØ±Ù‰ Ø·Ù„Ø¨ Ø¨Ù€ 0 Ø£ØµÙ†Ø§Ù ÙˆÙ…Ø¨Ù„Øº 0
- Ø§Ù„Ù€ promo code ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡ Ù„ÙƒÙ† Ø§Ù„Ø·Ù„Ø¨ ÙŠØ¨Ù‚Ù‰ "ÙŠØªÙŠÙ…"

**Ù†ÙØ³ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** `src/app/api/payment/kashier/initiate/route.ts` (Ø£Ø³Ø·Ø± 99-178) â€” Ø¥Ø°Ø§ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ±ØŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙØ­ÙˆÙÙ‘Ù„ Ù„Ù€ Kashier Ù„Ø¯ÙØ¹ Ø·Ù„Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†Ø§ØµØ±.

### 2.2 CRITICAL: Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ ØªÙØ­Ø³Ø¨ Client-Side ÙˆØªÙÙˆØ«Ù‚ Ø¨Ù‡Ø§ Server-Side

```typescript
// src/app/[locale]/checkout/page.tsx â€” Ø³Ø·Ø± 1028
const finalTotal = subtotal + calculatedDeliveryFee - discountAmount;

// Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… ØªÙØ±Ø³Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù€ database:
.insert({
  subtotal: subtotal,           // â† Ù…Ø­Ø³ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­
  delivery_fee: deliveryFee,    // â† Ù…Ø­Ø³ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­
  discount: discountAmount,     // â† Ù…Ø­Ø³ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­
  total: finalTotal,            // â† Ù…Ø­Ø³ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­
})
```

**Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ ØªØ­Ù‚Ù‚ Server-Side** Ù…Ù† Ø£Ù†:

- `subtotal` = Ù…Ø¬Ù…ÙˆØ¹ (Ø³Ø¹Ø±_Ø§Ù„ÙˆØ­Ø¯Ø© Ã— Ø§Ù„ÙƒÙ…ÙŠØ©) Ù„ÙƒÙ„ ØµÙ†Ù
- `delivery_fee` ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø©
- `discount` Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø®ØµÙ… Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„ÙƒÙˆØ¯

**Ø§Ù„Ù…Ø®Ø§Ø·Ø±:**

- Ø¹Ù…ÙŠÙ„ Ø®Ø¨ÙŠØ« ÙŠÙ…ÙƒÙ†Ù‡ ØªØ¹Ø¯ÙŠÙ„ `subtotal` Ù…Ù† 500 Ù„Ù€ 50 Ø¬Ù†ÙŠÙ‡
- Ø§Ù„Ù€ `platform_commission` trigger ÙŠØ­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØµØ­ÙŠØ­Ø§Ù‹... Ù„ÙƒÙ† Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ Ø®Ø§Ø·Ø¦
- Ù„Ø§ ÙŠÙˆØ¬Ø¯ audit trail ÙŠÙƒØ´Ù Ø§Ù„ØªÙ„Ø§Ø¹Ø¨

### 2.3 CRITICAL: Cart ÙÙŠ localStorage â€” Ø£Ø³Ø¹Ø§Ø± Ù…Ø¬Ù…Ø¯Ø©

```typescript
// src/lib/store/cart.ts â€” Ø³Ø·Ø± 316-317
storage: createJSONStorage(() => localStorage),
```

Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ:

1. Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¶ÙŠÙ ÙˆØ¬Ø¨Ø© Ø¨Ø³Ø¹Ø± 100 Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ø³Ø§Ø¹Ø© 2:00 PM
2. Ø§Ù„ØªØ§Ø¬Ø± ÙŠØ±ÙØ¹ Ø§Ù„Ø³Ø¹Ø± Ù„Ù€ 150 Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ø³Ø§Ø¹Ø© 3:00 PM
3. Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ·Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø© 6:00 PM Ø¨Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (100 Ø¬Ù†ÙŠÙ‡)
4. Ø§Ù„Ø·Ù„Ø¨ ÙŠÙÙ†Ø´Ø£ Ø¨Ù€ 100 Ø¬Ù†ÙŠÙ‡ â€” Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ù† localStorage Ù„Ø§ ØªÙØ­Ø¯ÙÙ‘Ø«

**Ù„Ø§ ÙŠÙˆØ¬Ø¯ re-validation Ù„Ù„Ø£Ø³Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù€ checkout.**

### 2.4 Ù„Ø§ ÙŠÙˆØ¬Ø¯ Double-Submit Prevention

```typescript
// src/app/[locale]/checkout/page.tsx â€” Ø³Ø·Ø± 972
const handlePlaceOrder = async () => {
  // Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙˆØ­ÙŠØ¯Ø©: setIsLoading(true) â€” client-side React state
  // Ù„Ø§ ÙŠÙˆØ¬Ø¯ idempotency key
  // Ù„Ø§ ÙŠÙˆØ¬Ø¯ unique constraint ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
  // Ù„Ø§ ÙŠÙˆØ¬Ø¯ server-side deduplication
```

Ø¹Ù†Ø¯ double-click Ø³Ø±ÙŠØ¹ Ø£Ùˆ Ø¶Ø¹Ù Ø§Ù„Ø´Ø¨ÙƒØ©ØŒ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ÙŠÙ† Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†.

### 2.5 Ù„Ø§ ÙŠÙˆØ¬Ø¯ Status Transition Guards

```typescript
// src/lib/repositories/orders-repository.ts â€” Ø³Ø·Ø± 441-472
// updateStatus ÙŠÙÙ†ÙØ° UPDATE ... WHERE id = ? ÙÙ‚Ø·
// Ù„Ø§ ÙŠÙˆØ¬Ø¯ WHERE status = 'current_status'
// ÙŠÙ…ÙƒÙ† Ù†Ù‚Ù„ Ø·Ù„Ø¨ Ù…Ù† 'delivered' Ø¥Ù„Ù‰ 'pending' Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø­Ù…Ø§ÙŠØ©
```

### 2.6 Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙÙŠ Data Integrity

| Ø§Ù„Ù…ÙŠØ²Ø©                             | Ø§Ù„ØªÙ‚ÙŠÙŠÙ…                                                                                            |
| ---------------------------------- | -------------------------------------------------------------------------------------------------- |
| Commission Calculation             | Ù…Ù…ØªØ§Ø² â€” PostgreSQL trigger ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙ„Ø§Ø¹Ø¨                                                            |
| Payment Webhook Idempotency        | Ù…Ù…ØªØ§Ø² â€” 5 Ø·Ø¨Ù‚Ø§Øª Ø­Ù…Ø§ÙŠØ© (terminal state, cancelled check, duplicate txn, status guard, empty result) |
| Promo Code Optimistic Locking      | Ø¬ÙŠØ¯ â€” compare-and-swap Ø¹Ù„Ù‰ `usage_count`                                                           |
| Financial Views as Source of Truth | Ù…Ù…ØªØ§Ø² â€” `financial_settlement_engine` Ùˆ `admin_financial_summary`                                  |

---

## Ø§Ù„Ù‚Ø³Ù… 3: Resiliency & Error Handling (62/100)

### 3.1 Error Boundaries: Ø¬ÙŠØ¯

| Ø§Ù„Ø­Ø¯           | Ø§Ù„Ù…Ù„Ù                                 | Sentry               | Recovery                    |
| -------------- | ------------------------------------- | -------------------- | --------------------------- |
| Global (fatal) | `src/app/global-error.tsx`            | Ù†Ø¹Ù…ØŒ level: `fatal`  | Reset                       |
| Locale         | `src/app/[locale]/error.tsx`          | Ù†Ø¹Ù…ØŒ tag: `locale`   | Reset + Home                |
| Admin          | `src/app/[locale]/admin/error.tsx`    | Ù†Ø¹Ù…ØŒ tag: `admin`    | Reset + Dashboard           |
| Provider       | `src/app/[locale]/provider/error.tsx` | Ù†Ø¹Ù…ØŒ tag: `provider` | Reset + Dashboard + Support |

**âœ… ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­:** ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ error boundaries ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· hardcoded Ù„Ù€ `/ar`. ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡Ø§ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… `usePathname()` Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ locale Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹.

### 3.2 SDUI Graceful Degradation: Ù…Ù…ØªØ§Ø²

Ù†Ø¸Ø§Ù… 3 Ø·Ø¨Ù‚Ø§Øª ÙÙŠ `src/hooks/sdui/useSDUI.ts`:

1. **Ø§Ù„Ø·Ø¨Ù‚Ø© 1:** Hardcoded defaults â€” Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ ÙÙˆØ±Ø§Ù‹
2. **Ø§Ù„Ø·Ø¨Ù‚Ø© 2:** LocalStorage cache Ø¨Ù€ TTL 30 Ø¯Ù‚ÙŠÙ‚Ø©
3. **Ø§Ù„Ø·Ø¨Ù‚Ø© 3:** Supabase RPC fetch â€” Ø¥Ø°Ø§ ÙØ´Ù„ØŒ ÙŠØ³ØªÙ…Ø± Ù…Ø¹ Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£Ù‚Ù„

**Ù‚Ø±Ø§Ø± Ù‡Ù†Ø¯Ø³ÙŠ Ø°ÙƒÙŠ:** Ø­ØªÙ‰ Ø®Ø·Ø£ `42883` (Type Cast) ÙŠÙØ¹Ø§Ù…Ù„ Ø¨ØµÙ…Øª â€” Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØªÙˆÙ‚Ù Ø£Ø¨Ø¯Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ SDUI.

### 3.3 Firebase Graceful Degradation: Ø¬ÙŠØ¯

- Lazy loading Ù„Ù„Ù€ SDK
- Null-safe returns ÙÙŠ ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª
- Feature detection Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Notification/ServiceWorker/PushManager
- Ø¥Ø°Ø§ Firebase Ù…Ø¹Ø·Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ Ø¨Ø¯ÙˆÙ† push notifications

### 3.4 CRITICAL: Server-Side Validation Ø´Ø¨Ù‡ Ù…Ø¹Ø¯ÙˆÙ…Ø©

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Ù…Ù† 46 API route:                                           â•‘
â•‘  â”€ ØªØ³ØªØ®Ø¯Ù… withErrorHandler:  5 (10.9%)  â† ØªØ­Ø³Ù‘Ù† Ù…Ù† 0%      â•‘
â•‘  â”€ ØªØ³ØªØ®Ø¯Ù… withValidation:    2 (4.3%)   â† ØªØ­Ø³Ù‘Ù† Ù…Ù† 0%      â•‘
â•‘  â”€ ØªØ³ØªØ®Ø¯Ù… try-catch ÙŠØ¯ÙˆÙŠ:   41 (89.1%)                     â•‘
â•‘                                                              â•‘
â•‘  ØªÙ… ØªÙØ¹ÙŠÙ„ withErrorHandler ÙÙŠ:                              â•‘
â•‘  banners/track, contact, admin/stats, admin/orders,          â•‘
â•‘  auth/resend-verification (endpoint Ø¬Ø¯ÙŠØ¯)                   â•‘
â•‘  Ù„ÙƒÙ† 41 route Ù„Ø§ ØªØ²Ø§Ù„ ØªØ³ØªØ®Ø¯Ù… try-catch ÙŠØ¯ÙˆÙŠ                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 3.5 CRITICAL: Silent Failures ÙÙŠ Ù…Ø³Ø§Ø±Ø§Øª Ø­Ø±Ø¬Ø©

| Ø§Ù„Ù…Ù„Ù                     | Ø§Ù„Ø³Ø·Ø±         | Ø§Ù„Ø³ÙŠØ§Ù‚                                                    | Ø§Ù„Ø®Ø·ÙˆØ±Ø©   |
| ------------------------- | ------------- | --------------------------------------------------------- | --------- |
| `ProvidersClient.tsx`     | 326           | ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ù„Ø§Øª â€” `catch {}` Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø£Ùˆ Sentry | **Ø­Ø±Ø¬**   |
| `delete-account/route.ts` | 62-80         | Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ â€” 6 Ø¹Ù…Ù„ÙŠØ§Øª delete Ø¨Ø¯ÙˆÙ† ÙØ­Øµ Ù†ØªÙŠØ¬Ø© Ø£ÙŠ Ù…Ù†Ù‡Ø§       | **Ø­Ø±Ø¬**   |
| `RefundRequestModal.tsx`  | 249, 314, 330 | 3 ÙØ´Ù„ ØµØ§Ù…Øª: Ø±ÙØ¹ ØµÙˆØ±Ø©ØŒ Ø¥Ù†Ø´Ø§Ø¡ ØªØ°ÙƒØ±Ø©ØŒ Ø¥Ø´Ø¹Ø§Ø±                  | **Ø¹Ø§Ù„ÙŠ**  |
| `useHereMaps.ts`          | 55-167        | 4 fetch calls Ø¨Ø¯ÙˆÙ† `response.ok` check                    | **Ø¹Ø§Ù„ÙŠ**  |
| `AppUpdateDialog.tsx`     | 59            | ÙØ­Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙŠÙØ´Ù„ Ø¨ØµÙ…Øª â€” Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù† ÙŠØ¹Ø±Ù Ø¨ØªØ­Ø¯ÙŠØ« Ø£Ù…Ù†ÙŠ    | **Ù…ØªÙˆØ³Ø·** |
| `middleware.ts`           | 50            | maintenance mode check ÙŠÙØ´Ù„ Ø¨ØµÙ…Øª â€” ÙŠØªØ®Ø·Ù‰ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©      | **Ù…ØªÙˆØ³Ø·** |

### 3.6 Sentry Configuration: Ø¬ÙŠØ¯

- 3 Ø¨ÙŠØ¦Ø§Øª: Client + Server + Edge
- Data scrubbing Ù„Ù„Ù€ headers Ø§Ù„Ø­Ø³Ø§Ø³Ø© (authorization, cookie, api-key)
- Session replay 1% ÙÙŠ productionØŒ 10% Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
- Smart error filtering (ResizeObserver, ChunkLoadError, etc.)

**Ù…Ø´ÙƒÙ„Ø©:** Edge config Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ data scrubbing â€” headers auth Ù‚Ø¯ ØªÙØ³Ø±ÙÙ‘Ø¨ Ù„Ù€ Sentry Ù…Ù† middleware.

---

## Ø§Ù„Ù‚Ø³Ù… 4: Security & Observability (72/100)

### 4.1 RLS: Ø¬ÙŠØ¯ Ù…Ø¹ ØªØ³Ø±Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø±Ø¬

**Ø§Ù„Ù‚ÙˆØ©:** ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø«ØºØ±Ø© `OR true` ÙÙŠ `providers` RLS. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ views ØªØ­ÙˆÙ„Øª Ù…Ù† `SECURITY DEFINER` Ø¥Ù„Ù‰ `SECURITY INVOKER`.

**CRITICAL: ØªØ³Ø±Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©**

```sql
-- supabase/migrations/20260213000004_tighten_rls_policies.sql Ø³Ø·Ø± 22
-- Ø³ÙŠØ§Ø³Ø© profiles SELECT:
USING (auth.uid() IS NOT NULL)
-- Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ ÙŠØ³ØªØ·ÙŠØ¹ Ù‚Ø±Ø§Ø¡Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©!
-- Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ: email, phone, full_name
```

**Ø§Ù„Ù…Ø®Ø§Ø·Ø±:** ØªØ§Ø¬Ø± ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¬Ø¯ÙˆÙ„ `profiles` ÙˆØ±Ø¤ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†. Ø­ØªÙ‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø±Ø¤ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ø´Ø®ØµÙŠØ©. Ø§Ù„Ù…Ù„Ù Ù†ÙØ³Ù‡ ÙŠØ¹ØªØ±Ù Ø£Ù†Ù‡Ø§ "interim fix".

### 4.2 Endpoint Protection Matrix

| Endpoint                            | Auth        | Rate Limit        | Ø§Ù„Ù…Ø´ÙƒÙ„Ø©                                                                             |
| ----------------------------------- | ----------- | ----------------- | ----------------------------------------------------------------------------------- |
| `POST /api/banners/track`           | **Ù„Ø§**      | **Ù„Ø§**            | ğŸ”¶ Zod validation Ù…ÙÙØ¹Ù‘Ù„ (withValidation). Ù„Ø§ ÙŠØ²Ø§Ù„ Ø¨Ø¯ÙˆÙ† auth â€” ÙŠÙ‚Ø¨Ù„ `user_id` ØªØ¹Ø³ÙÙŠ |
| `POST /api/contact`                 | **Ù„Ø§**      | **Ù„Ø§**            | ğŸ”¶ Zod validation Ù…ÙÙØ¹Ù‘Ù„ (withValidation). ÙŠØ³ØªØ®Ø¯Ù… admin client â€” spam risk          |
| `POST /api/auth/register`           | Ù„Ø§ (public) | **Ù„Ø§**            | Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠ Ù…Ù…ÙƒÙ†                                                             |
| `POST /api/webhooks/menu-item`      | **Ø§Ø®ØªÙŠØ§Ø±ÙŠ** | **Ù„Ø§**            | Ø¥Ø°Ø§ env var Ù…ÙÙ‚ÙˆØ¯ØŒ Ø§Ù„Ù€ webhook Ù…ÙØªÙˆØ­                                                |
| `POST /api/promo/validate`          | Ù†Ø¹Ù…         | **in-memory ÙÙ‚Ø·** | Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¹Ø¨Ø± serverless instances                                                    |
| `POST /api/admin/*`                 | Ù†Ø¹Ù… (admin) | **Ù„Ø§**            | Ø­Ø³Ø§Ø¨ admin Ù…Ø®ØªØ±Ù‚ = data exfiltration Ø¨Ø¯ÙˆÙ† Ø­Ø¯ÙˆØ¯                                      |
| `POST /api/chat`                    | Ù†Ø¹Ù…         | Ù†Ø¹Ù… (Upstash)     | **Ù…Ø­Ù…ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**                                                                  |
| `POST /api/payment/kashier/webhook` | Signature   | N/A               | **Ù…Ù…ØªØ§Ø²**                                                                           |

### 4.3 RBAC (Role-Based Access Control): Ø¬ÙŠØ¯

- Middleware RBAC ÙŠÙØ­Øµ Ø§Ù„Ø¯ÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ `/admin/*` Ùˆ `/provider/*`
- ÙƒÙ„ API route admin ÙŠÙØ­Øµ Ø§Ù„Ø¯ÙˆØ± Ù…Ø³ØªÙ‚Ù„Ø§Ù‹ (defense-in-depth)
- RLS policies ØªØ­Ù…ÙŠ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### 4.4 Rate Limiting Architecture

```
Upstash Redis (Ù…ÙˆØ²Ø¹ - ÙŠØ¹Ù…Ù„ Ø¹Ø¨Ø± instances):
â”œâ”€â”€ OTP send:       5 / 10 min
â”œâ”€â”€ OTP verify:     5 / 5 min
â”œâ”€â”€ Login:          10 / 15 min
â”œâ”€â”€ Password reset: 3 / hour
â”œâ”€â”€ Chat API:       30 / min
â”œâ”€â”€ Voice order:    10 / min
â”œâ”€â”€ Order creation: 20 / 5 min
â””â”€â”€ Search:         60 / min

In-Memory (Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¹Ø¨Ø± instances):
â”œâ”€â”€ Promo validation: 10 / min  â† Ù…Ø´ÙƒÙ„Ø©
â””â”€â”€ Legacy rate-limit.ts         â† Ù…Ø´ÙƒÙ„Ø©
```

### 4.5 Monitoring & Alerting: Ù†Ø§Ù‚Øµ

| Ø§Ù„Ø£Ø¯Ø§Ø©                            | Ø§Ù„Ø­Ø§Ù„Ø©                                        |
| --------------------------------- | --------------------------------------------- |
| Sentry Error Tracking             | Ù…ÙÙØ¹Ù‘Ù„                                        |
| Sentry Session Replay             | Ù…ÙÙØ¹Ù‘Ù„ (1%)                                   |
| Vercel Analytics                  | Ù…ÙÙØ¹Ù‘Ù„                                        |
| Vercel Speed Insights             | Ù…ÙÙØ¹Ù‘Ù„                                        |
| **Alerting Rules**                | **ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯** â€” Ù„Ø§ PagerDuty, Ù„Ø§ Slack alerts |
| **Suspicious Activity Detection** | **ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯**                                 |
| **Rate Limit Violation Alerts**   | **ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯**                                 |
| **Log Aggregation**               | **ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯** â€” Ù„Ø§ Datadog, Ù„Ø§ CloudWatch     |

**ÙŠØ¹Ù†ÙŠ:** Ø¥Ø°Ø§ Ø­Ø¯Ø« Ù‡Ø¬ÙˆÙ… Ø£Ùˆ Ø®Ù„Ù„ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 3 ØµØ¨Ø§Ø­Ø§Ù‹ØŒ Ù„Ù† ÙŠØ¹Ø±Ù Ø£Ø­Ø¯ Ø­ØªÙ‰ ÙŠØ´ØªÙƒÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†.

### 4.6 Security Strengths

| Ø§Ù„Ù…ÙŠØ²Ø©                | Ø§Ù„ØªÙ‚ÙŠÙŠÙ…                            |
| --------------------- | ---------------------------------- |
| CSP Headers           | Ù…Ù…ØªØ§Ø² â€” Ø´Ø§Ù…Ù„ ÙˆÙ…ÙØµÙ„                 |
| CSRF Protection       | Ù…Ù…ØªØ§Ø² â€” double-submit cookie       |
| Zod Client Validation | Ù…Ù…ØªØ§Ø² â€” Ø´Ø§Ù…Ù„                       |
| Secret Management     | Ù…Ù…ØªØ§Ø² â€” Ù„Ø§ secrets Ù…ÙƒØ´ÙˆÙØ©          |
| XSS Protection        | Ù…Ù…ØªØ§Ø² â€” enterprise-grade headers   |
| HSTS                  | Ù…Ù…ØªØ§Ø² â€” 2 Ø³Ù†Ø© Ù…Ø¹ includeSubDomains |
| Webhook Signature     | Ù…Ù…ØªØ§Ø² â€” Kashier webhook Ù…Ø­Ù…ÙŠ       |

---

## Ø§Ù„Ù‚Ø³Ù… 5: Frontend Architecture (40/100)

### 5.1 Server vs Client Rendering: ÙƒØ§Ø±Ø«ÙŠ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Ù…Ù† 117 route:                                              â•‘
â•‘  â”€ Client Components ('use client'):  112 (95.7%)           â•‘
â•‘  â”€ Server Components:                   5 (4.3%)            â•‘
â•‘                                                              â•‘
â•‘  Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ:                                                  â•‘
â•‘  â€¢ ÙƒÙ„ ØµÙØ­Ø© ØªØ±Ø³Ù„ JavaScript ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ØªØµÙØ­                    â•‘
â•‘  â€¢ Ù„Ø§ SSR/SSG Ù„Ø£ÙŠ ØµÙØ­Ø© Ø¹Ù…ÙŠÙ„                                â•‘
â•‘  â€¢ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù†ÙØ³Ù‡Ø§ 'use client'                       â•‘
â•‘  â€¢ SEO = ØµÙØ± (Google ÙŠÙÙ‡Ø±Ø³ HTML ÙØ§Ø±Øº)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 5.2 Loading States: ØªØ­Ø³Ù‘Ù† Ù…Ù„Ø­ÙˆØ¸

| Ø§Ù„Ù…Ù‚ÙŠØ§Ø³             | Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© | Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© |
| ------------------- | -------------- | -------------- |
| Routes Ø¥Ø¬Ù…Ø§Ù„ÙŠ       | 117            | 117            |
| `loading.tsx`       | 4 (3.4%)       | 13 (11.1%)     |
| Suspense boundaries | 0              | 0              |

**ØªØ­Ø¯ÙŠØ«:** ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© 9 Ù…Ù„ÙØ§Øª `loading.tsx` Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹: `checkout`, `providers`, `search`, `orders`, `cart`, `favorites`, `profile`, `offers`, `notifications`. Ù„Ø§ ØªØ²Ø§Ù„ 104 route Ø¨Ø¯ÙˆÙ† loading state.

### 5.3 Code Splitting: ØªØ­Ø³Ù‘Ù† Ø¬Ø²Ø¦ÙŠ

| Ø§Ù„Ù…Ù‚ÙŠØ§Ø³                | Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©           | Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©           |
| ---------------------- | ------------------------ | ------------------------ |
| `next/dynamic`         | 4 Ù…Ù„ÙØ§Øª                  | 6 Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª (Home page)  |
| `React.lazy()`         | 0                        | 0                        |
| Ù…Ù„ÙØ§Øª Ø£ÙƒØ¨Ø± Ù…Ù† 1500 Ø³Ø·Ø± | 5 Ù…Ù„ÙØ§Øª                  | 5 Ù…Ù„ÙØ§Øª                  |
| Ø£ÙƒØ¨Ø± Ù…Ù„Ù               | 2,909 Ø³Ø·Ø± (Admin Orders) | 2,909 Ø³Ø·Ø± (Admin Orders) |

**ØªØ­Ø¯ÙŠØ«:** `OffersCarousel` (ÙŠØ­ØªÙˆÙŠ framer-motion ~40KB) ØªÙ… ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù€ `next/dynamic` ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©. Ø§Ù„Ø¢Ù† 6 Ù…ÙƒÙˆÙ†Ø§Øª dynamically imported ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: `CategoriesSection`, `DeliveryModeSelector`, `ReorderSection`, `TopRatedSection`, `NearbySection`, `OffersCarousel`.

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨Ø±Ù‰:**

1. `admin/orders/page.tsx` â€” 2,909 Ø³Ø·Ø±
2. `provider/orders/page.tsx` â€” 2,301 Ø³Ø·Ø±
3. `checkout/page.tsx` â€” 2,209 Ø³Ø·Ø±
4. `admin/providers/page.tsx` â€” ~1,900 Ø³Ø·Ø±
5. `provider/menu/page.tsx` â€” ~1,800 Ø³Ø·Ø±

ÙƒÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙØ­Ù…Ù‘Ù„ ÙƒÙˆØ­Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø£ÙŠ splitting.

### 5.4 Image Optimization: Ø¬ÙŠØ¯

- 92.9% Ù…Ù† Ø§Ù„ØµÙˆØ± ØªØ³ØªØ®Ø¯Ù… `next/image`
- AVIF + WebP Ù…ÙÙØ¹Ù‘Ù„Ø§Ù† ÙÙŠ `next.config.ts`
- `priority` prop Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù€ LCP images

### 5.5 framer-motion Impact: Ù…ØªÙˆØ³Ø·

- Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ 28/267 Ù…Ù„Ù (10.5%)
- **Ù„ÙŠØ³ over-engineering** â€” ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ù€ page transitions Ùˆ carousel animations
- Ù„ÙƒÙ† `OffersCarousel.tsx` (933 Ø³Ø·Ø±) Ùˆ `HeroSection` ÙŠÙØ­Ù…Ù‘Ù„Ø§Ù† eagerly Ù…Ø¹ framer-motion ÙÙŠ Ø§Ù„Ù€ initial bundle

### 5.6 lucide-react: Ù…Ù…ØªØ§Ø²

- Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ 202/267 Ù…Ù„Ù â€” Ù„ÙƒÙ† Ù…Ø¹ **named imports ÙÙ‚Ø·**
- Tree-shaking ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ â€” ÙÙ‚Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ØªÙØ­Ù…Ù‘Ù„
- **Ù„Ø§ Ù…Ø´ÙƒÙ„Ø© Ù‡Ù†Ø§**

### 5.7 Home Page: Client-Side Data Waterfall

```
Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ­Ù…Ù„ JavaScript â†’ ÙŠÙÙ†ÙØ° React â†’ ÙŠØ¨Ø¯Ø£ fetch Ù…Ù† Supabase
                                              â†“
                              HeroSection ÙŠØ¬Ù„Ø¨ banners (fetch #1)
                              OffersCarousel ÙŠØ¬Ù„Ø¨ offers (fetch #2)
                              Categories ÙŠØ¬Ù„Ø¨ categories (fetch #3)
                              Providers ÙŠØ¬Ù„Ø¨ providers (fetch #4)
```

ÙƒÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù€ fetches ØªØ­Ø¯Ø« **Ø¨Ø¹Ø¯** ØªØ­Ù…ÙŠÙ„ ÙˆØªÙ†ÙÙŠØ° JavaScript. Ø¹Ù„Ù‰ SSR ÙƒØ§Ù† Ù…Ù…ÙƒÙ† ØªÙØ­Ù…Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ HTML Ù…Ø¨Ø§Ø´Ø±Ø©.

---

## Ø§Ù„Ù‚Ø³Ù… 6: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± â€” 10,000 Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ²Ø§Ù…Ù†

### 6.1 Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ

```
10,000 Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ²Ø§Ù…Ù†:
â”œâ”€â”€ 8,000 Ø¹Ù…ÙŠÙ„ (customers)
â”œâ”€â”€ 1,500 ØªØ§Ø¬Ø± (providers)
â”œâ”€â”€ 50 Ù…Ø¯ÙŠØ± (admins)
â””â”€â”€ 450 Ø²Ø§Ø¦Ø± (unauthenticated)
```

### 6.2 Ø­Ù…Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹

| Ø§Ù„Ù…ØµØ¯Ø±                  | Ø§Ù„Ø­Ø³Ø§Ø¨                   | Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª/Ø«Ø§Ù†ÙŠØ© |
| ----------------------- | ------------------------ | ----------------- |
| Customer Polling        | 8,000 Ã— 2 queries / 30s  | 533               |
| Customer getUser()      | 8,000 Ã— 1 / 30s          | 267               |
| Provider Polling        | 1,500 Ã— 6 queries / 60s  | 150               |
| Admin Polling           | 50 Ã— 5 queries / 30s     | 8                 |
| Middleware queries      | 10,000 Ã— 2 avg / 5s avg  | 4,000             |
| Page data fetches       | 10,000 Ã— 3 avg / 30s avg | 1,000             |
| Realtime WAL processing | Fixed overhead           | ~500              |
| governorates/static     | 10,000 Ã— 1 / 30s avg     | 333               |
| **Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹**             |                          | **~6,791/Ø«Ø§Ù†ÙŠØ©**  |

### 6.3 Supabase Connection Limits

| Ø§Ù„Ø®Ø·Ø© | Max Connections | Ø§Ù„Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯ system overhead |
| ----- | --------------- | -------------------------- |
| Free  | 60              | ~40                        |
| Pro   | 60              | ~40                        |
| Team  | 120             | ~90                        |

**Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:** 9 Ø§ØªØµØ§Ù„Ø§Øª (Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª DB). Ù„ÙƒÙ† Ù…Ø¹ 10K Ù…Ø³ØªØ®Ø¯Ù…:

- PostgREST pooler ÙŠØ¯ÙŠØ± Ø§Ù„Ø§ØªØµØ§Ù„Ø§ØªØŒ Ù„ÙƒÙ† ~6,800 query/s Ø¹Ø¨Ø± 40 connection = 170 query/connection/second
- PostgreSQL Ø¹Ù„Ù‰ Supabase Pro ÙŠØ¹Ø§Ù„Ø¬ ~10,000-15,000 query/s ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰

### 6.4 Ù†Ù‚Ø§Ø· Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ø§Ù†Ù‡ÙŠØ§Ø± Ø¹Ù†Ø¯ 10K Ù…ØªØ²Ø§Ù…Ù†:              â•‘
â•‘                                                                  â•‘
â•‘  â±ï¸ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© 0-30:                                               â•‘
â•‘     - Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø¨Ø·Ø¡ Ù…Ù„Ø­ÙˆØ¸                                    â•‘
â•‘     - Response times ØªØ±ØªÙØ¹ Ù…Ù† 200ms Ø¥Ù„Ù‰ 2-5 Ø«ÙˆØ§Ù†               â•‘
â•‘     - Supabase connection pool ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø§Ù…ØªÙ„Ø§Ø¡                    â•‘
â•‘                                                                  â•‘
â•‘  â±ï¸ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© 30-60:                                              â•‘
â•‘     - Connection pool Ù…Ø´Ø¨Ø¹ â€” Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ØªÙ†ØªØ¸Ø± ÙÙŠ Queue         â•‘
â•‘     - Timeouts ØªØ¨Ø¯Ø£ â€” polling intervals ØªÙØ´Ù„                     â•‘
â•‘     - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙŠØ­Ø¯Ø«ÙˆÙ† Ø§Ù„ØµÙØ­Ø© (refresh) â†’ Ø­Ù…Ù„ Ù…Ø¶Ø§Ø¹Ù           â•‘
â•‘                                                                  â•‘
â•‘  â±ï¸ Ø§Ù„Ø³Ø§Ø¹Ø© 1-2:                                                 â•‘
â•‘     - WAL processing ÙŠØ³ØªÙ‡Ù„Ùƒ CPU Ø¨Ø§Ù„ÙƒØ§Ù…Ù„                          â•‘
â•‘     - Realtime subscriptions ØªÙØ´Ù„ Ø¨ØµÙ…Øª (Ù„Ø§ error handling)       â•‘
â•‘     - Ø§Ù„Ù€ polling ÙŠØ³ØªÙ…Ø± Ø¨Ø¯ÙˆÙ† visibility guard                     â•‘
â•‘     - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØ²ÙŠØ¯ÙˆÙ† Ø§Ù„Ø­Ù…Ù„ Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø¯Ø©              â•‘
â•‘                                                                  â•‘
â•‘  â±ï¸ Ø§Ù„Ø³Ø§Ø¹Ø© 2-4:                                                 â•‘
â•‘     - PostgreSQL max CPU â†’ queries ØªÙØ´Ù„                          â•‘
â•‘     - Supabase rate limits ØªÙÙØ¹Ù‘Ù„ (Ø¥Ø°Ø§ ÙƒÙ†Øª Ø¹Ù„Ù‰ Free/Pro)        â•‘
â•‘     - Ø§Ù„Ø³ÙŠØ³ØªÙ… ÙŠØ³Ù‚Ø· ØªÙ…Ø§Ù…Ø§Ù‹ Ø£Ùˆ ÙŠØµØ¨Ø­ ØºÙŠØ± Ù…Ø³ØªØ¬ÙŠØ¨                    â•‘
â•‘     - Ù„Ø§ Ø£Ø­Ø¯ ÙŠØ¹Ø±Ù â€” Ù„Ø§ ÙŠÙˆØ¬Ø¯ alerting!                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 6.5 Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø®Ù…Ø³Ø© Ø§Ù„Ù‚Ø§ØªÙ„Ø©

| #   | Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©                       | Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„   | Ø§Ù„Ø£Ø«Ø± | ÙˆØµÙ                                                           |
| --- | ------------------------------ | ---------- | ----- | ------------------------------------------------------------- |
| 1   | **DB CPU Exhaustion**          | Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹ | ÙƒØ§Ø±Ø«ÙŠ | 6,800 query/s + WAL processing ØªØªØ¬Ø§ÙˆØ² Ù‚Ø¯Ø±Ø© Supabase Pro       |
| 2   | **Connection Pool Saturation** | Ù…Ø±ØªÙØ¹      | ÙƒØ§Ø±Ø«ÙŠ | 40 connection Ù„Ù€ 6,800 query/s = queue overflow               |
| 3   | **Memory Leak Ù…Ù† Polling**     | Ù…Ø±ØªÙØ¹      | Ø¹Ø§Ù„ÙŠ  | Tabs ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø¯ÙˆÙ† visibility guard ØªØ³ØªÙ‡Ù„Ùƒ Ù…ÙˆØ§Ø±Ø¯ Ø¨Ù„Ø§ ÙØ§Ø¦Ø¯Ø©  |
| 4   | **Double Orders under Load**   | Ù…ØªÙˆØ³Ø·      | Ø¹Ø§Ù„ÙŠ  | Ø¨Ø¯ÙˆÙ† idempotency keyØŒ latency Ø¹Ø§Ù„ÙŠ + retry = duplicate orders |
| 5   | **No Alerting**                | Ù…Ø¤ÙƒØ¯       | Ø¹Ø§Ù„ÙŠ  | Ù„Ù† ÙŠØ¹Ø±Ù Ø£Ø­Ø¯ Ø£Ù† Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ø§Ù†ÙŠ Ø­ØªÙ‰ ÙŠØ´ØªÙƒÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†              |

---

## Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©

Ø±ØºÙ… Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŒ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø±Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ© Ù…Ù…ØªØ§Ø²Ø©:

### 1. Commission Trigger (10/10)

Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ­Ø³Ø¨ Ø­ØµØ±ÙŠØ§Ù‹ Ø¹Ø¨Ø± PostgreSQL trigger â€” Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù„Ù€ client Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ Ø¨Ù‡Ø§. Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ­Ø¯Ù‡ ÙŠÙ…Ù†Ø¹ ÙØ¦Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©.

### 2. Payment Webhook Idempotency (10/10)

5 Ø·Ø¨Ù‚Ø§Øª Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ replay attacks Ùˆ race conditions. Ù‡Ø°Ø§ ÙƒÙˆØ¯ enterprise-grade.

### 3. SDUI 3-Layer Fallback (9/10)

Defaults â†’ Cache â†’ Server. Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØªÙˆÙ‚Ù Ø£Ø¨Ø¯Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ ÙØ´Ù„ SDUI. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø·Ø£ `42883` Ø¨Ø°ÙƒØ§Ø¡.

### 4. Security Headers (9/10)

CSP Ø´Ø§Ù…Ù„Ø©ØŒ HSTS Ù…Ø¹ preloadØŒ CSRF double-submitØŒ XSS protection. Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ enterprise.

### 5. Financial Views as Source of Truth (9/10)

SQL views (`financial_settlement_engine`, `admin_financial_summary`) ØªØ¶Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ© ØªØ£ØªÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù† Ù…ØµØ¯Ø± ÙˆØ§Ø­Ø¯.

### 6. Error Class Hierarchy (8/10)

`AppError â†’ ValidationError, AuthenticationError, RateLimitError` â€” Ù…Ø¹ `toJSON()` Ùˆ `isOperational` flags. Ù…Ø¨Ù†ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ù…ØªØ§Ø².

### 7. Sentry Integration (8/10)

3 Ø¨ÙŠØ¦Ø§Øª (Client/Server/Edge)ØŒ data scrubbingØŒ smart filteringØŒ session replay.

### 8. Zod Client Validation (8/10)

Egyptian phone schemasØŒ address validationØŒ comprehensive order schemas.

### 9. Firebase Graceful Degradation (8/10)

Null-safe returnsØŒ feature detectionØŒ lazy loading. Ù„Ø§ crashes Ø¥Ø°Ø§ Firebase Ù…Ø¹Ø·Ù„.

### 10. RLS Security Hardening (7/10)

Ø¥ØµÙ„Ø§Ø­ `OR true`ØŒ ØªØ­ÙˆÙŠÙ„ views Ù„Ù€ `SECURITY INVOKER`ØŒ RBAC ÙÙŠ middleware + API + DB layers.

---

## Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„Ù€ 99.9% Availability

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 0: Ø¥Ù†Ù‚Ø§Ø° ÙÙˆØ±ÙŠ (Ø£Ø³Ø¨ÙˆØ¹ 1 â€” Ù‚Ø¨Ù„ Ø£ÙŠ growth) â€” 90% Ù…ÙƒØªÙ…Ù„ âœ…

| #   | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡                                                                         | Ø§Ù„Ø­Ø§Ù„Ø©   | Ø§Ù„ØªÙØ§ØµÙŠÙ„                                                                                                                                                                                                                                          |
| --- | ------------------------------------------------------------------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | **ØªÙØ¹ÙŠÙ„ Cache Layer Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯** Ù„Ù€ governorates, categories, maintenance settings | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ  | `src/lib/cache/cached-queries.ts` ÙŠØ­ØªÙˆÙŠ `getCachedGovernorates()` Ùˆ `getCachedBusinessCategories()` Ùˆ `getCachedDeliveryFees()`. Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ `Footer.tsx` Ùˆ `CategoriesSection.tsx`. Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† (admin pages, middleware) Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ù€ cache Ø¨Ø¹Ø¯ |
| 2   | **Ø¥Ø¶Ø§ÙØ© `document.visibilitychange`** Ù„ÙƒÙ„ polling                               | âœ… Ù…ÙƒØªÙ…Ù„ | `src/hooks/useVisibilityPolling.ts` Ù…ÙÙ†Ø¬Ø² Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ visibility detection. Ù…ÙØ³ØªØ®Ø¯Ù… ÙÙŠ `BottomNavigation.tsx` (Ø³Ø·Ø± 74) Ùˆ `ProviderLayout.tsx` (Ø£Ø³Ø·Ø± 495-507) Ù…Ø¹ pause/resume Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù€ tab                                                |
| 3   | **Ø¥Ø²Ø§Ù„Ø© `getUser()` Ù…Ù† BottomNavigation polling**                               | âœ… Ù…ÙƒØªÙ…Ù„ | `BottomNavigation.tsx` (Ø£Ø³Ø·Ø± 37-42) ÙŠØ¬Ù„Ø¨ userId Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ mount Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… `useEffect` ÙˆÙŠØ®Ø²Ù†Ù‡ ÙÙŠ ref. Ø§Ù„Ù€ polling callback (Ø£Ø³Ø·Ø± 45-66) ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù€ ref Ø§Ù„Ù…ÙØ®Ø²Ù† Ø¨Ø¯Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ `getUser()` ÙƒÙ„ Ø¯ÙˆØ±Ø©                                                  |
| 4   | **ØªØ­ÙˆÙŠÙ„ pending orders Ù„Ù€ COUNT** Ø¨Ø¯Ù„ SELECT rows                               | âœ… Ù…ÙƒØªÙ…Ù„ | `ProviderLayout.tsx` (Ø£Ø³Ø·Ø± 410-469) ÙŠØ³ØªØ®Ø¯Ù… `select('*', { count: 'exact', head: true })` Ù„Ø¬Ù…ÙŠØ¹ badge counts Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ pending orders. ÙŠÙØ±Ø¬Ø¹ Ø§Ù„Ø¹Ø¯Ø¯ ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø¬Ù„Ø¨ Ø§Ù„ØµÙÙˆÙ                                                                              |
| 5   | **ØªÙØ¹ÙŠÙ„ Realtime Manager** Ø¨Ø¯Ù„ raw `.subscribe()` ÙÙŠ ProviderLayout             | âœ… Ù…ÙƒØªÙ…Ù„ | `ProviderLayout.tsx` (Ø£Ø³Ø·Ø± 191-389) ÙŠØ³ØªØ®Ø¯Ù… `subscribeWithErrorHandling()` Ù…Ù† `src/lib/supabase/realtime-manager.ts` Ù…Ø¹ exponential backoff Ùˆ polling fallback Ùˆ connection status tracking                                                        |

**Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…ÙØ­Ù‚Ù‚:** ØªØ®ÙÙŠØ¶ queries/second Ø¨Ù†Ø³Ø¨Ø© ~40% â€” Ø§Ù„Ø¨Ù†Ø¯ #1 ÙŠØ­ØªØ§Ø¬ ØªÙˆØ³ÙŠØ¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ cache Ù„Ø¨Ù‚ÙŠØ© Ø§Ù„Ø£Ù…Ø§ÙƒÙ†.

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø£Ø³Ø¨ÙˆØ¹ 2) â€” 100% Ù…ÙƒØªÙ…Ù„ âœ…

| #   | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡                                                                             | Ø§Ù„Ø­Ø§Ù„Ø©   | Ø§Ù„ØªÙØ§ØµÙŠÙ„                                                                                                                                                                                                                                      |
| --- | ----------------------------------------------------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 6   | **Ø¥Ù†Ø´Ø§Ø¡ RPC `create_order_atomic`** ÙŠØ¬Ù…Ø¹ order + items + promo ÙÙŠ transaction ÙˆØ§Ø­Ø¯Ø© | âœ… Ù…ÙƒØªÙ…Ù„ | Migration `supabase/migrations/20260226000001_create_order_atomic.sql` ØªÙÙ†Ø´Ø¦ RPC Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³ ÙÙŠ PostgreSQL transaction ÙˆØ§Ø­Ø¯Ø©. ØªØ´Ù…Ù„ idempotency key Ùˆ server-side price validation Ùˆ promo code atomic increment Ù…Ø¹ optimistic locking |
| 7   | **Ø¥Ø¶Ø§ÙØ© server-side price validation** ÙÙŠ RPC Ø£Ùˆ API route                          | âœ… Ù…ÙƒØªÙ…Ù„ | Ø§Ù„Ù€ RPC ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù (Ø£Ø³Ø·Ø± 78-112) Ù…Ù‚Ø§Ø¨Ù„ `menu_items` Ùˆ `product_variants`ØŒ ÙŠØ­Ø³Ø¨ subtotal Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆÙŠÙ‚Ø§Ø±Ù†Ù‡ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙØ±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù€ tolerance 0.01. ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ server-side (Ø³Ø·Ø± 158)                              |
| 8   | **Ø¥Ø¶Ø§ÙØ© idempotency key** (UUID) Ù…Ø¹ unique constraint Ø¹Ù„Ù‰ orders                    | âœ… Ù…ÙƒØªÙ…Ù„ | Migration ØªÙØ¶ÙŠÙ Ø¹Ù…ÙˆØ¯ `idempotency_key UUID` Ù„Ù„Ù€ orders (Ø³Ø·Ø± 17) Ù…Ø¹ unique constraint (Ø£Ø³Ø·Ø± 18-20). Ø§Ù„Ù€ RPC ÙŠÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ø³Ø§Ø¨Ù‚ Ø¨Ù†ÙØ³ Ø§Ù„Ù…ÙØªØ§Ø­ (Ø£Ø³Ø·Ø± 63-75) ÙˆÙŠÙØ±Ø¬Ø¹ idempotent flag                                                                |
| 9   | **Ø¥Ø¶Ø§ÙØ© status transition guards** (`WHERE status = ?`)                             | âœ… Ù…ÙƒØªÙ…Ù„ | Migration ØªÙÙ†Ø´Ø¦ trigger `guard_order_status_transition()` (Ø£Ø³Ø·Ø± 262-304) ÙŠÙØ¹Ø±Ù‘Ù Ø§Ù„ØªØ­ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© (pendingâ†’confirmed/cancelled, confirmedâ†’preparing/cancelled, Ø¥Ù„Ø®) ÙˆÙŠØ±ÙØ¶ Ø§Ù„ØªØ­ÙˆÙ„Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©                                                |
| 10  | **Ø¥ØµÙ„Ø§Ø­ profiles RLS** â€” column-level access Ø£Ùˆ USING Ù…Ø¹ owner check                | âœ… Ù…ÙƒØªÙ…Ù„ | Migration `supabase/migrations/20260226000002_fix_profiles_rls.sql` ØªÙØ·Ø¨Ù‘Ù‚ 4 Ø³ÙŠØ§Ø³Ø§Øª: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ‚Ø±Ø£ Ù…Ù„ÙÙ‡ Ø§Ù„Ø´Ø®ØµÙŠ (Ø³Ø·Ø± 27)ØŒ Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø¬Ù…ÙŠØ¹ (Ø³Ø·Ø± 36)ØŒ Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…ØªØ¬Ø± ÙŠÙ‚Ø±Ø£ Ù…Ù„ÙØ§Øª Ø¹Ù…Ù„Ø§Ø¦Ù‡ (Ø£Ø³Ø·Ø± 39-49)ØŒ ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙˆÙ† ÙŠÙ‚Ø±Ø¤ÙˆÙ† Ù…Ù„ÙØ§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ø£Ø³Ø·Ø± 52-63) |

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù€ Frontend (Ø£Ø³Ø¨ÙˆØ¹ 3-4) â€” 63% Ù…ÙƒØªÙ…Ù„

| #   | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡                                                           | Ø§Ù„Ø­Ø§Ù„Ø©     | Ø§Ù„ØªÙØ§ØµÙŠÙ„                                                                                                                                                                                                                                                                                                                                                                        |
| --- | ----------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 11  | **ØªØ­ÙˆÙŠÙ„ Home Page Ù„Ù€ Server Component** Ù…Ø¹ `fetch` + `revalidate` | âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | `src/app/[locale]/page.tsx` (Ø³Ø·Ø± 1) Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØ­ØªÙˆÙŠ `'use client'`. Ø§Ù„ØµÙØ­Ø© ØªØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª client-side Ø¹Ø¨Ø± hooks Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† server-side Ù…Ø¹ revalidate                                                                                                                                                                                                                                 |
| 12  | **Ø¥Ø¶Ø§ÙØ© `loading.tsx`** Ù„Ø£Ù‡Ù… 20 route                             | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | **ØªØ­Ø³Ù‘Ù†:** Ù…Ù† 4 Ø¥Ù„Ù‰ 13 Ù…Ù„Ù `loading.tsx` (11.1%). ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© 9 Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©: `checkout`, `providers`, `search`, `orders`, `cart`, `favorites`, `profile`, `offers`, `notifications`. Ù„Ø§ ÙŠØ²Ø§Ù„ Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ù‡Ø¯Ù 20 route â€” 104 route Ø¨Ø¯ÙˆÙ† loading state                                                                                                                                |
| 13  | **ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©** (>1500 Ø³Ø·Ø±) Ø¨Ù€ `next/dynamic`           | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | **ØªØ­Ø³Ù‘Ù†:** Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ØªØ³ØªØ®Ø¯Ù… `next/dynamic` Ù„Ù€ 6 Ù…ÙƒÙˆÙ†Ø§Øª: `CategoriesSection`, `DeliveryModeSelector`, `ReorderSection`, `TopRatedSection`, `NearbySection`, `OffersCarousel` (ÙŠØ­ØªÙˆÙŠ framer-motion ~40KB). Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù„Ø§ ØªØ²Ø§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ: admin/orders (2909 Ø³Ø·Ø±), provider/orders (2301 Ø³Ø·Ø±), checkout (2209 Ø³Ø·Ø±), admin/providers (~1900 Ø³Ø·Ø±), provider/menu (~1800 Ø³Ø·Ø±) |
| 14  | **Ø¥Ø¶Ø§ÙØ© ISR** Ù„Ù€ providers listing, categories, governorates      | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | ISR Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ `providers/page.tsx` (`revalidate=300`) Ùˆ `providers/[id]/page.tsx` (`revalidate=300`). Ù„Ø§ ÙŠÙˆØ¬Ø¯ ISR Ù„ØµÙØ­Ø§Øª categories Ø£Ùˆ governorates                                                                                                                                                                                                                             |

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ù…ØªØ§Ù†Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (Ø£Ø³Ø¨ÙˆØ¹ 5-6) â€” 42% Ù…ÙƒØªÙ…Ù„

| #   | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡                                                 | Ø§Ù„Ø­Ø§Ù„Ø©     | Ø§Ù„ØªÙØ§ØµÙŠÙ„                                                                                                                                                                                           |
| --- | ------------------------------------------------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 15  | **ØªÙØ¹ÙŠÙ„ `withErrorHandler`** ÙÙŠ Ø¬Ù…ÙŠØ¹ API routes         | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | **ØªØ­Ø³Ù‘Ù†:** Ù…Ù† 0 Ø¥Ù„Ù‰ 5 routes (10.9%). Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ: `banners/track`, `contact`, `admin/stats`, `admin/orders`, `auth/resend-verification`. Ù„Ø§ ÙŠØ²Ø§Ù„ 41 route ÙŠØ³ØªØ®Ø¯Ù… try-catch ÙŠØ¯ÙˆÙŠ                     |
| 16  | **ØªÙØ¹ÙŠÙ„ `withValidation`** ÙÙŠ Ø¬Ù…ÙŠØ¹ API routes           | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | **ØªØ­Ø³Ù‘Ù†:** Ù…Ù† 0 Ø¥Ù„Ù‰ 2 routes (4.3%). Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ: `banners/track` (Zod schema: banner_id, event_type, user_id), `contact` (Zod schema). Ù„Ø§ ÙŠØ²Ø§Ù„ 44 route Ø¨Ø¯ÙˆÙ† validation middleware                  |
| 17  | **Ø¥Ø¶Ø§ÙØ© Alerting** (Slack/PagerDuty) Ù„Ù€ critical errors | âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Slack webhooks Ø£Ùˆ PagerDuty ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹. Sentry Ù…ÙÙØ¹Ù‘Ù„ Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„ÙƒÙ† Ø¨Ø¯ÙˆÙ† ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©                                                                                    |
| 18  | **Rate limiting Ù„Ù€ register, contact, banners/track**   | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | `promo/validate` ÙŠØ­ØªÙˆÙŠ rate limiting in-memory (Ø£Ø³Ø·Ø± 34-50). Chat API ÙŠØ³ØªØ®Ø¯Ù… Upstash Redis rate limiting. Ù„ÙƒÙ† **Ù„Ø§ ÙŠÙˆØ¬Ø¯ rate limiting** Ø¹Ù„Ù‰ `auth/register`, `contact`, Ø£Ùˆ `banners/track` ØªØ­Ø¯ÙŠØ¯Ø§Ù‹ |
| 19  | **Ø­Ø°Ù Ø§Ù„Ù€ 120+ ÙÙ‡Ø±Ø³ Ø§Ù„Ù…ÙŠØª**                             | âœ… Ù…ÙƒØªÙ…Ù„   | Migration `20260225000001_fix_unused_indexes.sql` ØªØ­Ø°Ù 9 ÙÙ‡Ø§Ø±Ø³ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø© (Ø£Ø³Ø·Ø± 18-38) Ø¨Ø´ÙƒÙ„ Ù…Ù†Ù‡Ø¬ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª `pg_stat_user_indexes`                                                         |
| 20  | **ØªÙ‚Ù„ÙŠÙ„ Realtime publication** Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙ‚Ø·     | âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | Migrations `20251207000005` Ùˆ `20251207000006` **ØªÙØ¶ÙŠÙ** Ø¬Ø¯Ø§ÙˆÙ„ Ù„Ù€ `supabase_realtime` publication Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø²Ø§Ù„ØªÙ‡Ø§. Ù„Ù… ÙŠØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù€ publication Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙ‚Ø·                         |

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„ØªØ­Ø¬ÙŠÙ… (Ø£Ø³Ø¨ÙˆØ¹ 7-8) â€” 30% Ù…ÙƒØªÙ…Ù„

| #   | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡                                                   | Ø§Ù„Ø­Ø§Ù„Ø©     | Ø§Ù„ØªÙØ§ØµÙŠÙ„                                                                                                                                                                                                                               |
| --- | --------------------------------------------------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 21  | **Cart price re-validation** Ø¹Ù†Ø¯ checkout                 | ğŸ”¶ Ø¬Ø²Ø¦ÙŠ    | ØµÙØ­Ø© Checkout ØªØ±Ø³Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© client-side Ù„Ù„Ø³ÙŠØ±ÙØ±. Ø§Ù„Ù€ RPC `create_order_atomic` ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø°Ø±ÙŠØ©ØŒ Ù„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¬Ø¯ re-validation Ø¹Ù†Ø¯ ÙØªØ­ ØµÙØ­Ø© checkout Ù†ÙØ³Ù‡Ø§ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ `menu_items` |
| 22  | **ØªÙØ¹ÙŠÙ„ `strongPasswordSchema`** ÙÙŠ auth                  | âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | `src/lib/validations/common.ts` ÙŠÙØ¹Ø±Ù‘Ù `strongPasswordSchema` Ù„ÙƒÙ†Ù‡Ø§ ØºÙŠØ± Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø£Ùˆ Ù…ÙØ³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© auth. ØµÙØ­Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§ ØªØªØ­Ù‚Ù‚ Ù…Ù‚Ø§Ø¨Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù€ schema                                                      |
| 23  | **Ø¥ØµÙ„Ø§Ø­ error boundaries locale** â€” Ø§Ø³ØªØ®Ø±Ø§Ø¬ locale Ù…Ù† URL | âœ… Ù…ÙƒØªÙ…Ù„   | **ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­:** Ø¬Ù…ÙŠØ¹ error boundaries (`[locale]/error.tsx`, `[locale]/admin/error.tsx`, `[locale]/provider/error.tsx`) ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¢Ù† `usePathname()` Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ locale Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† hardcoded `/ar`                            |
| 24  | **Ø¥Ø¶Ø§ÙØ© Edge config data scrubbing**                      | âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | `sentry.edge.config.ts` (Ø£Ø³Ø·Ø± 33-47) ÙŠØ­ØªÙˆÙŠ `beforeSend()` ÙŠÙØ±Ø´Ù‘Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©ØŒ Ù„ÙƒÙ† **Ù„Ø§ ÙŠÙˆØ¬Ø¯ data scrubbing** Ù„Ù€ auth headers Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© ÙƒÙ…Ø§ ÙÙŠ server config. Ø§Ù„Ù€ headers Ù‚Ø¯ ØªØªØ³Ø±Ø¨ Ù„Ù€ Sentry Ù…Ù† middleware                |
| 25  | **ØªÙØ¹ÙŠÙ„ Upstash Ù„Ù€ promo validation** Ø¨Ø¯Ù„ in-memory       | âŒ Ù„Ù… ÙŠØ¨Ø¯Ø£ | `src/app/api/promo/validate/route.ts` (Ø£Ø³Ø·Ø± 34-50) ÙŠØ³ØªØ®Ø¯Ù… rate limiting in-memory (`rateLimitMap`). Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¹Ø¨Ø± serverless instances. Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù„Ù€ Upstash Redis ÙƒÙ…Ø§ ÙÙŠ Chat API                                              |

---

## Ø§Ù„Ø®Ù„Ø§ØµØ©

### Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù…ÙØ­Ù‚Ù‚

```
Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£ØµÙ„ÙŠ:         Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°):   Ø§Ù„Ù‡Ø¯Ù (Ø¨Ø¹Ø¯ ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Score: 61/100          Score: ~82/100 (+21)          Score: ~92/100
Max Users: ~2,000      Max Users: ~8,000 âœ…          Max Users: ~25,000+
Downtime: hours        Downtime: minutes âœ…          Downtime: <5min/month
Alerting: none         Alerting: none âŒ             Alerting: comprehensive
Data Safety: risky     Data Safety: solid âœ…         Data Safety: excellent
```

### Ù…Ø§ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡ (Ù…Ù„Ø®Øµ)

**Ø§Ù„Ù…Ø±Ø­Ù„Ø© 0+1 (Ø§Ù„Ø£ÙƒØ«Ø± Ø£Ù‡Ù…ÙŠØ©) Ø´Ø¨Ù‡ Ù…ÙƒØªÙ…Ù„Ø©:**

- âœ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø£ØµØ¨Ø­Øª Ø°Ø±ÙŠØ© (atomic) â€” Ù„Ø§ Ø·Ù„Ø¨Ø§Øª ÙŠØªÙŠÙ…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù†
- âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± server-side â€” Ù„Ø§ ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
- âœ… Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØªÙƒØ±Ø§Ø± (idempotency key) â€” Ù„Ø§ double-submit
- âœ… Ø­Ø±Ø§Ø³Ø© ØªØ­ÙˆÙ„Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© â€” Ù„Ø§ state transitions ØºÙŠØ± ØµØ§Ù„Ø­Ø©
- âœ… Ø¥ØµÙ„Ø§Ø­ RLS Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† â€” Ù„Ø§ ØªØ³Ø±Ø¨ PII
- âœ… Realtime Manager Ù…Ø¹ error recovery â€” Ø§ØªØµØ§Ù„Ø§Øª Ù…Ø³ØªÙ‚Ø±Ø©
- âœ… Visibility guard Ù„Ù„Ù€ polling â€” ØªÙˆÙÙŠØ± 30-50% Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª
- âœ… COUNT Ø¨Ø¯Ù„ SELECT Ù„Ù„Ù€ pending orders â€” ØªÙ‚Ù„ÙŠÙ„ Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 90%
- âœ… Ø­Ø°Ù Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…ÙŠØªØ© â€” ØªØ­Ø³ÙŠÙ† Write performance

**Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© â€” Performance & API Fixes:**

- âœ… ØªÙØ¹ÙŠÙ„ Cache Layer Ù„Ù€ `CategoriesSection.tsx` â€” ØªÙ‚Ù„ÙŠÙ„ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª categories
- âœ… Dynamic import Ù„Ù€ `OffersCarousel` â€” ØªØ£Ø¬ÙŠÙ„ ØªØ­Ù…ÙŠÙ„ framer-motion (~40KB)
- âœ… 9 Ù…Ù„ÙØ§Øª `loading.tsx` Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ù† 4 Ø¥Ù„Ù‰ 13) â€” ØªÙ‚Ù„ÙŠÙ„ CLS
- âœ… Ø¥Ù†Ø´Ø§Ø¡ endpoint `auth/resend-verification` Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ â€” Ø¥ØµÙ„Ø§Ø­ 404
- âœ… ØªÙØ¹ÙŠÙ„ `withErrorHandler` ÙÙŠ 5 API routes â€” error handling Ù…ÙˆØ­Ù‘Ø¯
- âœ… ØªÙØ¹ÙŠÙ„ `withValidation` Ù…Ø¹ Zod ÙÙŠ 2 API routes â€” server-side validation
- âœ… Ø¥ØµÙ„Ø§Ø­ locale ÙÙŠ error boundaries â€” Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„Ù€ i18n

### Ù…Ø§ ØªØ¨Ù‚Ù‰ â€” Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°

| Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© | Ø§Ù„Ø¨Ù†Ø¯                                                   | Ø§Ù„Ø³Ø¨Ø¨                                                                                           | Ø§Ù„Ø¬Ù‡Ø¯   |
| -------- | ------------------------------------------------------- | ----------------------------------------------------------------------------------------------- | ------- |
| ğŸ”´ 1     | **#15+16: ØªÙØ¹ÙŠÙ„ `withErrorHandler` Ùˆ `withValidation`** | Ù…ÙÙØ¹Ù‘Ù„ ÙÙŠ 5/46 route ÙÙ‚Ø·. ÙŠØ­ØªØ§Ø¬ ØªØºØ·ÙŠØ© Ø§Ù„Ù€ 41 route Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©. Ø£Ø¹Ù„Ù‰ ROI Ù…ØªØ¨Ù‚ÙŠ                     | 16 Ø³Ø§Ø¹Ø© |
| ğŸ”´ 2     | **#1: ØªÙˆØ³ÙŠØ¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Cache Layer**                       | Ù…ÙØ³ØªØ®Ø¯Ù… ÙÙŠ `Footer.tsx` Ùˆ `CategoriesSection.tsx` ÙÙ‚Ø·. ÙŠØ­ØªØ§Ø¬ ØªÙØ¹ÙŠÙ„ ÙÙŠ admin pages ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† | 4 Ø³Ø§Ø¹Ø§Øª |
| ğŸŸ  3     | **#20: ØªÙ‚Ù„ÙŠÙ„ Realtime publication**                     | ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø´ØªØ±ÙƒØ© ÙÙŠ WAL â€” ÙŠØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙ‚Ø·                                     | 4 Ø³Ø§Ø¹Ø§Øª |
| ğŸŸ  4     | **#17: Ø¥Ø¶Ø§ÙØ© Alerting**                                 | Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ù…Ø´Ø§ÙƒÙ„ â€” Ø®Ø·Ø± ÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ§Ø¬                                          | 4 Ø³Ø§Ø¹Ø§Øª |
| ğŸŸ  5     | **#12: Ø¥Ø¶Ø§ÙØ© `loading.tsx`** Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€ routes           | 13 Ù…Ù† 117 route (11.1%) â€” Ù„Ø§ ÙŠØ²Ø§Ù„ Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ù‡Ø¯Ù 20 route                                        | 4 Ø³Ø§Ø¹Ø§Øª |
| ğŸŸ¡ 6     | **#11: ØªØ­ÙˆÙŠÙ„ Home Page Ù„Ù€ Server Component**            | Ù„Ø§ ÙŠØ²Ø§Ù„ `'use client'` â€” ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ SEO Ùˆ LCP                                                     | 12 Ø³Ø§Ø¹Ø© |
| ğŸŸ¡ 7     | **#22, #24, #25: Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªØ­Ø¬ÙŠÙ… Ø§Ù„ØµØºÙŠØ±Ø©**                 | `strongPasswordSchema`, edge data scrubbing, Upstash Ù„Ù€ promo                                   | 5 Ø³Ø§Ø¹Ø§Øª |

### Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ²Ø§Ù„ Ù…Ø·Ù„ÙˆØ¨Ø©

1. **`withErrorHandler` Ùˆ `withValidation` Ù…ÙÙØ¹Ù‘Ù„Ø§Ù† Ø¬Ø²Ø¦ÙŠØ§Ù‹ ÙÙ‚Ø· (5/46 Ùˆ 2/46)** â€” Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¬ÙŠØ¯Ø© Ù„ÙƒÙ† Ø§Ù„ÙØ¬ÙˆØ© Ù„Ø§ ØªØ²Ø§Ù„ ÙƒØ¨ÙŠØ±Ø©. 41 route Ø¨Ø¯ÙˆÙ† error handling Ù…ÙˆØ­Ù‘Ø¯
2. **Ø§Ù„Ù€ Frontend Ù„Ø§ ÙŠØ²Ø§Ù„ Ø¶Ø¹ÙŠÙØ§Ù‹** â€” 95.7% client-rendered Ù…Ø¹ 13 `loading.tsx` Ù…Ù† 117 route
3. **Ù„Ø§ ÙŠÙˆØ¬Ø¯ Alerting** â€” Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ù„Ù„ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 3 ØµØ¨Ø§Ø­Ø§Ù‹ØŒ Ù„Ù† ÙŠØ¹Ø±Ù Ø£Ø­Ø¯

---

_ØªÙ‚Ø±ÙŠØ± Ù…ÙÙ†Ø´Ø£ Ø¨ØªØ§Ø±ÙŠØ®: 26 ÙØ¨Ø±Ø§ÙŠØ± 2026_
_Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°: 26 ÙØ¨Ø±Ø§ÙŠØ± 2026_
_Ø§Ù„Ù…ÙØ¹Ø¯: Claude â€” Senior Software Architect Audit_
_Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: 56% (11 Ù…ÙƒØªÙ…Ù„ØŒ 8 Ø¬Ø²Ø¦ÙŠØŒ 6 Ù„Ù… ÙŠØ¨Ø¯Ø£)_
